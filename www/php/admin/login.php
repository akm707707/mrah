<?php header('Content-type: application/json');	header('Content-Type: text/html; charset=utf-8'); require '../inc/functions.php'; //include 'coordinates.php'; // 	if ($_SERVER["REQUEST_METHOD"] == "POST") {	if (!isset($_POST['key']) || empty($_POST['key']) )   {		$responseArray = array('id' => 'danger', 'message' => 'لم تقم بإدخال رمز المنشأه');	} elseif (!isset($_POST['mobile']) || empty($_POST['mobile']) )   {		$responseArray = array('id' => 'danger', 'message' => 'لم تقم بإدخال اسم المستخدم');	} elseif (!isset($_POST['password']) || empty($_POST['password']) )   {		$responseArray = array('id' => 'danger', 'message' => 'لم تقم بإدخال كلمة المرور');	} else {			$mobile = mysqli_real_escape_string($link, $_POST['mobile']);				$mobile 	= a2e($mobile);		$key = mysqli_real_escape_string($link, $_POST['key']);						$key 		= a2e($key);		$password = mysqli_real_escape_string($link, $_POST['password']);			$password 	= a2e($password);		$hashed = md5($password);		// $dataarr = mysqli_query($link,"SELECT * FROM `entities` WHERE `mobile`='$mobile' AND `id`='$key'" );		$dataarr = mysqli_query($link,"SELECT * FROM `users` WHERE `mobile`='$mobile' AND `eid`='$key'" );		$data = mysqli_fetch_array($dataarr);		if ( mysqli_num_rows ( $dataarr ) > 0 ) {						$userid = $data['id'];			$status = $data['status'];			$clearance = $data['clearance'];			$color = $data['color'];			$name = $data['name'];			$salary = $data['salary'];			$allowences = $data['allowences'];			if ( $hashed == $data['hashed'] ) {				session_start();				$_SESSION["loggedin"] = true;				$_SESSION["name"] = $name;				$_SESSION["username"] = $mobile;				$_SESSION["identifier"] = $key;				$_SESSION["userid"] = $userid;				$_SESSION["userstatus"] = $status;				$_SESSION["userclearance"] = $clearance;				$_SESSION["color"] = $color;				$responseArray = array('id'=>'success', 'alert'=>'User Exists');			} else {				$responseArray = array('id'=>'danger', 'alert'=>'الرقم السري غير صحيح');			}	 		} else { $responseArray = array('id'=>'danger', 'alert'=>'أنت غير مسجل');	}	}} else {	$responseArray = array('id'=>'danger', 'alert'=>'خطأ بالخادم، حاول لاحقاً');	}// if requested by AJAX request return JSON responseif ( !empty($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest') {    $encoded = json_encode($responseArray);		header('Content-Type: application/json');	echo $encoded;} else { echo $responseArray['message'];	}		// else just display the message?>