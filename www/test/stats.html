<!DOCTYPE html>
<html lang="en" dir="rtl">

<head>
    <meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>مراح</title>
	<link rel="icon" type="image/png" href="imgs/icons/favicon.ico">
	<link rel="apple-touch-icon" href="imgs/icons/apple-touch-icon.png">
    <link href="css/themes/lite-purple.min.css" rel="stylesheet">
    <link href="css/extra/animatioin.css" rel="stylesheet">
    <link href="css/extra/iosfix.css" rel="stylesheet">
    <link href="css/plugins/perfect-scrollbar.min.css" rel="stylesheet" />
    <!-- <link rel="stylesheet" href="css/plugins/dropzone.min.css" /> -->
	<link href="css/plugins/perfect-scrollbar.min.css" rel="stylesheet" />
    <!-- <link rel="stylesheet" href="css/plugins/cropper.min.css" /> -->
    <link rel="stylesheet" href="css/plugins/animate.css" />
    <!-- <link rel="stylesheet" href="../dist-assets/css/plugins/datepicker/bootstrap-datepicker.css" /> -->
    <!-- <link rel="stylesheet" href="css/plugins/datepicker/bootstrap-datepicker.min.css" /> -->
    <!-- <link rel="stylesheet" href="css/plugins/datepicker/bootstrap-datepicker3.min.css" /> -->
	<script src="js/plugins/jquery-3.7.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="js/plugins/Semantic/semantic.rtl.min.css">
	<!-- <script src="js/scripts/customizer.script.min.js"></script> -->
	<script src="js/plugins/chartjs/chart.umd.min.js"></script>
	<script src="js/plugins/chartjs/chartjs-plugin-datalabels.min.js"></script>
	<script src="js/plugins/chartjs/chartjs-plugin-annotation.min.js"></script>
	<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js"></script> -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script> -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script> -->
	<!-- <script src="js/calculations.js"></script> -->

<script>
// For verify php
var username;
const leadzero = (num, places) => String(num).padStart(places, '0')				//userdataid = leadzero(identifier, 4)
//By Status
var live = 0;		var dead = 0;	var sick = 0;	var sold = 0;	var gifted = 0;	var killed = 0;
// Dead
var deadYellow = 0, deadGreen = 0, deadBlue = 0, deadWhite = 0;
// Sold
var soldYellow = 0, soldGreen = 0, soldBlue = 0, soldWhite = 0;
// Gifted
var giftedYellow = 0, giftedGreen = 0, giftedBlue = 0, giftedWhite = 0;
// Killed
var killedYellow = 0, killedGreen = 0, killedBlue = 0, killedWhite = 0;

//By sex
var sheepmale = 0;		var sheepfemale = 0;	var existingsheep = 0;	var sheepram = 0;
//By Age
var sheep1 = 0;		var sheep2 = 0;		var sheep3 = 0;		var sheep4 = 0;		var sheep5 = 0;		var sheep6 = 0;		
var sheep7 = 0;		var sheep8 = 0;		var sheep9 = 0;		var sheep10 = 0;	var sheep11 = 0;		
var sheep12 = 0;	var sheep24 = 0;	var sheep36 = 0;	var sheep48 = 0;	var sheep60 = 0;	var sheepagless = 0;
// Age by tag Color
// Now creating the 3 colored versions for each one:
var sheep1yellow = 0;   var sheep1green = 0;   var sheep1blue = 0;   var sheep1white = 0;
var sheep2yellow = 0;   var sheep2green = 0;   var sheep2blue = 0;   var sheep2white = 0;
var sheep3yellow = 0;   var sheep3green = 0;   var sheep3blue = 0;   var sheep3white = 0;
var sheep4yellow = 0;   var sheep4green = 0;   var sheep4blue = 0;   var sheep4white = 0;
var sheep5yellow = 0;   var sheep5green = 0;   var sheep5blue = 0;   var sheep5white = 0;
var sheep6yellow = 0;   var sheep6green = 0;   var sheep6blue = 0;   var sheep6white = 0;
var sheep7yellow = 0;   var sheep7green = 0;   var sheep7blue = 0;   var sheep7white = 0;
var sheep8yellow = 0;   var sheep8green = 0;   var sheep8blue = 0;   var sheep8white = 0;
var sheep9yellow = 0;   var sheep9green = 0;   var sheep9blue = 0;   var sheep9white = 0;
var sheep10yellow = 0;  var sheep10green = 0;  var sheep10blue = 0;  var sheep10white = 0;
var sheep11yellow = 0;  var sheep11green = 0;  var sheep11blue = 0;  var sheep11white = 0;
var sheep12yellow = 0;  var sheep12green = 0;  var sheep12blue = 0;  var sheep12white = 0;
var sheep24yellow = 0;  var sheep24green = 0;  var sheep24blue = 0;  var sheep24white = 0;
var sheep36yellow = 0;  var sheep36green = 0;  var sheep36blue = 0;  var sheep36white = 0;
var sheep48yellow = 0;  var sheep48green = 0;  var sheep48blue = 0;  var sheep48white = 0;
var sheep60yellow = 0;  var sheep60green = 0;  var sheep60blue = 0;  var sheep60white = 0;
var sheepaglessyellow = 0; var sheepaglessgreen = 0; var sheepaglessblue = 0; var sheepaglesswhite = 0;

//By Weight
var sheepw5   = 0;	var sheepw10  = 0;	var sheepw15  = 0;	var sheepw20  = 0;	var sheepw25  = 0;	var sheepw30  = 0;
var sheepw35  = 0;	var sheepw40  = 0;	var sheepw45  = 0;	var sheepw50  = 0;	var sheepw55  = 0;	var sheepw60  = 0;
var sheepw65  = 0;	var sheepw70  = 0;	var sheepw75  = 0;	var sheepw80  = 0;	var sheepw85  = 0;	var sheepw90  = 0;
var sheepw95  = 0;	var sheepw100 = 0;	var sheepweightless = 0;
//By Breed
var harri = 0;		var najdi = 0;		var naimi = 0;		var swakni = 0;		var rufaidi = 0;	var assaf = 0;
var awasi = 0;		var barbari = 0;	var habashi = 0;	var droper = 0;		var aradi = 0;		var merino = 0;
var goat = 0;		var other = 0;
// By tagcolor
var yellow = 0;		var orange = 0;		var blue = 0;		var red = 0;		var green = 0;		var pink = 0;	var white = 0;
var colorless = 0;
//By Cost
var cost500  = 0;	var cost600  = 0;	var cost700  = 0;	var cost800  = 0;	var cost900  = 0;	var cost1000 = 0;	
var cost1100 = 0;	var cost1200 = 0;	var cost1300 = 0;	var cost1400 = 0;	var cost1500 = 0;
var cost1600 = 0;	var cost1700 = 0;	var cost1800 = 0;	var cost1900 = 0;	var cost2000 = 0;
var cost2100 = 0;	var cost2200 = 0;	var cost2300 = 0;	var cost2400 = 0;	var cost2500 = 0;	
var cost2500plus = 0;					var costless = 0;
//By inclusion date live
var incdate3 = 0;		var incdate6 = 0;	var incdate9 = 0;	var incdate12 = 0;
var incdate15 = 0;		var incdate18 = 0;	var incdate21 = 0;	var incdate24 = 0;
var incdate27 = 0;		var incdate30 = 0;	var incdate33 = 0;	var incdate36 = 0;
var incdate39 = 0;		var incdate42 = 0;	var incdate45 = 0;	var incdate48 = 0;
var incdate51 = 0;		var incdate54 = 0;	var incdate57 = 0;	var incdate60 = 0;
var incdateless = 0;
//By inclusion date absent
var incdate3absent = 0;		var incdate6absent = 0;		var incdate9absent = 0;		var incdate12absent = 0;
var incdate15absent = 0;	var incdate18absent = 0;	var incdate21absent = 0;	var incdate24absent = 0;
var incdate27absent = 0;	var incdate30absent = 0;	var incdate33absent = 0;	var incdate36absent = 0;
var incdate39absent = 0;	var incdate42absent = 0;	var incdate45absent = 0;	var incdate48absent = 0;
var incdate51absent = 0;	var incdate54absent = 0;	var incdate57absent = 0;	var incdate60absent = 0;
var incdatelessabsent = 0;
// for horizontal charting
var MIN_HEIGHT_PER_BAR = 35;     // ← tune this: 45–65px recommended for Arabic + padding
var	EXTRA_SPACE        = 35;    // title + legend space + padding + axis labels
var newbornarray = [];
var backgroundColor = [];

function getContrastColor(context) {
  const bg = context.dataset.backgroundColor;
  let bgColor;

  if (Array.isArray(bg)) {
    bgColor = bg[context.dataIndex];
  } else {
    bgColor = bg; // single color for whole dataset
  }

  if (!bgColor || !bgColor.startsWith('#')) return '#000000'; // fallback

  const hex = bgColor.replace('#', '');
  const r = parseInt(hex.substr(0,2), 16);
  const g = parseInt(hex.substr(2,2), 16);
  const b = parseInt(hex.substr(4,2), 16);

  const brightness = (r * 0.299 + g * 0.587 + b * 0.114);
  return brightness > 140 ? '#000000' : '#ffffff';
}

</script>

</head>

<style>


@supports (-webkit-touch-callout: none) {
  .iconioselevated {
    -webkit-text-size-adjust: none !important;
		font-size: 1.6rem !important;
  }
}

.ui.button:focus {
  box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.08) !important;
}




</style>


<body class="text-left">
    <div class="app-admin-wrap layout-sidebar-compact clearfix">
        <div class="main-content-wrap d-flex flex-column mb-5">
            <div class="main-header">
                <div class="logo" style="display:block;">
					<img id="logo" src="imgs/logo_out.jpg" >
                </div>
                <div class="title mobilehide" style="margin-right: 9vw;">
					<h1></h1>
                </div>
                <!-- <div class="menu-toggle" style="display:none;"><div></div><div></div><div></div></div> -->
                
                <div style="margin: auto; display:none;"></div>
                <div class="header-part-right">
                    <!-- Full screen toggle -->
                    <!-- <i class="i-Full-Screen header-icon d-none d-sm-inline-block" data-fullscreen></i> -->
					<!-- Notificaiton -->
                    <div class="dropdown pl-3" style="margin-bottom:-6px">
                        <div class="badge-top-container" role="button" id="dropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <!-- <span class="badge badge-primary">3</span> -->
                            <!-- <i class="i-Bell text-muted header-icon"  -->
							<i class="fa-regular fa-bell" style="height: 21px;width: 21px;color: #b3b2b4;margin-right: 11px;"></i>
                        </div>
					</div>
                    <!-- Customizer Dropdown -->
                    <!-- <i class="i-Gear header-icon  d-sm-inline-block callcustomizer" ></i> -->
					<a href="finance.html" target="">
						<img src="imgs/sar.svg"  alt="Description of the image" width="22" height="22" class="filter-grey"/>
					</a>
					<a href="setting.html" target="" >
						<i class="fa-solid fa-gear pr-3" style="height: 21px;width: 21px;color: #b3b2b4;margin-right: 11px;margin-top: 5px;"></i>
					</a>					
                    <!-- sign out -->
					<i class="fa-solid fa-power-off header-icon pr-2 signout" style="height: 21px;width: 21px;color: #b3b2b4;margin-right: 11px;"></i>
                    <!-- Notificaiton End -->
                    <!-- User avatar dropdown -->
                    <!-- <div class="dropdown"> -->
                        <!-- <div class="user col align-self-end "> -->
                            <!-- <img src="" id="avatar" alt="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> -->
                            <!-- <div class="dropdown-menu dropdown-menu-left" aria-labelledby="avatar"> -->
                                <!-- <div class="dropdown-header"> -->
                                    <!-- <i class="mr-1 empname"></i>   -->
                                <!-- </div> -->
                                <!-- <a class="dropdown-item signout" >خروج</a> -->
                            <!-- </div> -->
                        <!-- </div> -->
                    <!-- </div> -->
                </div>
            </div><!-- ============ Body content start ============= -->
            <div class="main-content">
					  <button class="mini ui grey button charttoggle" style="background: white;border-radius: 23px;color: #e5e7eb;box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.08);display: inline-grid;padding: 5px;position: fixed;right: 0;top: calc(50% - 66px);z-index: 999999999;">
						<i class="fa-solid fa-chart-pie text-125 text-c-green iconioselevated mb-2 pt-1 " ></i>
						<i class="fa-solid fa-align-justify text-125 iconioselevated pb-1 "></i>
					  </button>

                <div class="breadcrumb mb-0">
				<div class="row pb-3" style="width: 100%;">
                    <h4 class="mr-2 mrahtitle col-lg-11 col-md-10 col-sm-8 col-xs-8 ml-0 pl-0 " style="padding-right: 15px !important;padding-top: 0.35rem !important;"></h4>
					<!-- <div class="dropdown col-lg-1 col-md-2 col-sm-4 col-xs-4 pl-0 " > -->
					  <!-- <button class="mini ui grey button charttoggle" style="background: transparent;border-radius: 999px;color: #e5e7eb;box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.08);"> -->
						<!-- <i class="fa-solid fa-chart-pie text-125 text-c-green iconioselevated " ></i> -->
						<!-- <i class="fa-solid fa-align-justify text-125 iconioselevated "></i> -->
					  <!-- </button> -->
					<!-- </div> -->

                </div>
                </div>
                <div class="separator-breadcrumb border-top" style="display:flex;">
				</div>
                <div class="row mainrow">
					<div class="card-columns">
					</div>			
				</div>			
            </div>
        </div>
    </div><!-- ============ Search UI Start ============= -->
    <div class="modal fade columntoggle" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg ">
            <div class="modal-content">
				<div class="modalrow">
					<div class="col-md-12 modalcard">
                        <div class="card">
							<div class="card-header-modal-green m"><h4 class="marginless"style="">إظهار وإخفاء الأعمده</h4></div>
                            <div class="card-body">
                                <form>
                                    <div class="row checkboxes">
                                    </div>
                                </form>
                            </div>
                            <div class="card-footer">
                                <form>
								    <div class="row">
										<div class="col-xs-12 col-sm-12 col-md-12 mb-1 centered hideshow"><label class="checkbox checkbox-outline-primary" ><input class="global" name="select" type="checkbox" checked ><span>تحديد الكل</span><span class="checkmark"></span></label></div>									
									</div>
                                </form>
                            </div>
                        </div>
                    </div>
				</div>
            </div>
        </div>
    </div>
	<!-- ============ LOADER MODAL ============= -->
    <div class="modal fade loader" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg " style="width: fit-content;  max-width: 700px;	margin: 1.75rem auto;">
			<div class="spinner-bubble spinner-bubble-primary m-5"></div>
		</div>
    </div>
	<!-- ============ Search UI End ============= -->
    <div class="customizer" style="display:none;" >
        <div class="handle" style="display:none;"><i class="i-Gear spin"></i></div>
        <div class="customizer-body" data-perfect-scrollbar="" data-suppress-scroll-x="true">
            <div class="accordion" id="accordionCustomizer">
                <div class="card">
                    <div class="card-header-modal-green" id="headingOne">
                        <p class="mb-0">تغيير لون الموقع</p>
                    </div>
                    <div class="collapse show" id="collapseOne" aria-labelledby="headingOne" data-parent="#accordionCustomizer">
                        <div class="card-body">
                            <div class="colors sidebar-colors"><a class="color gradient-purple-indigo" data-sidebar-class="sidebar-gradient-purple-indigo"><i class="i-Eye"></i></a><a class="color gradient-black-blue" data-sidebar-class="sidebar-gradient-black-blue"><i class="i-Eye"></i></a><a class="color gradient-black-gray" data-sidebar-class="sidebar-gradient-black-gray"><i class="i-Eye"></i></a><a class="color gradient-steel-gray" data-sidebar-class="sidebar-gradient-steel-gray"><i class="i-Eye"></i></a><a class="color dark-purple active" data-sidebar-class="sidebar-dark-purple"><i class="i-Eye"></i></a><a class="color slate-gray" data-sidebar-class="sidebar-slate-gray"><i class="i-Eye"></i></a><a class="color midnight-blue" data-sidebar-class="sidebar-midnight-blue"><i class="i-Eye"></i></a><a class="color blue" data-sidebar-class="sidebar-blue"><i class="i-Eye"></i></a><a class="color indigo" data-sidebar-class="sidebar-indigo"><i class="i-Eye"></i></a><a class="color pink" data-sidebar-class="sidebar-pink"><i class="i-Eye"></i></a><a class="color red" data-sidebar-class="sidebar-red"><i class="i-Eye"></i></a><a class="color purple" data-sidebar-class="sidebar-purple"><i class="i-Eye"></i></a></div>
                        </div>
                    </div>
                </div>
                <!-- <div class="card"> -->
                    <!-- <div class="card-header-modal-green" id="headingOne"> -->
                        <!-- <p class="mb-0">RTL</p> -->
                    <!-- </div> -->
                    <!-- <div class="collapse show" id="collapseTwo" aria-labelledby="headingTwo" data-parent="#accordionCustomizer"> -->
                        <!-- <div class="card-body"> -->
                            <!-- <label class="checkbox checkbox-primary"> -->
                                <!-- <input id="rtl-checkbox" type="checkbox" /><span>Enable RTL</span><span class="checkmark"></span> -->
                            <!-- </label> -->
                        <!-- </div> -->
                    <!-- </div> -->
                <!-- </div> -->
            </div>
        </div>
    </div>
<div>
    <script src="js/plugins/jquery-3.7.1.min.js"></script>
    <script src="js/plugins/bootstrap.bundle.min.js"></script>
    <script src="js/plugins/perfect-scrollbar.min.js"></script>
    <script src="js/scripts/script.min.js"></script>
    <script src="js/scripts/sidebar.compact.script.min.js"></script>
    <!-- <script src="js/scripts/customizer.script.min.js"></script> -->
    <!-- <script src="js/plugins/echarts.min.js"></script> -->
    <!-- <script src="js/scripts/echart.options.min.js"></script> -->
    <!-- <script src="js/scripts/dashboard.v1.script.min.js"></script> -->
    <!-- <script src="js/plugins/dropzone.min.js"></script> -->
    <!-- <script src="js/scripts/dropzone.script.min.js"></script> -->
    <!-- <script src="js/plugins/cropper.min.js"></script> -->
    <!-- <script src="js/scripts/cropper.script.min.js"></script> -->
    <!-- <script src="js/plugins/datepicker/bootstrap-datepicker.min.js"></script> -->
    <!-- <script src="js/plugins/datepicker/locales/bootstrap-datepicker.ar.min.js"></script> -->
	<!-- <!-- <script src="js/plugins/datatables.min.js"></script> -->
	<script src="js/plugins/allfontawesome7.js"></script>
	<script src="js/plugins/Semantic/semantic.min.js"></script>
	<script src="js/scripts/tooltip.script.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
	<script src="js/calculations.js"></script>
</div>
<script>
$(document).ready(function(){

let isSubmitting = false;
var totalcapitalloss = 0;
var netbudget = 0;
var prenetbudget = 0;
var netbudget = 0;
var postbudget = 0;
var previousprofit = 0;
var previousexpense = 0;
var totalspending = 0;
var finaltotal = 0;
		
// verify login credintials and retreive Bussniess data
var start = new Date().getTime();
 $.ajax({	
	type: 'POST',	
	url    : "php/verify.php",
 })
 .done(function(response) {												//console.log(response); 
 var end = new Date().getTime();		console.log('Seconds passed', ((end - start)/1000));

	if ( response.id == 'success' ) {		
	
		userid = Number(response.data.userid);
		name = response.data.name;
		mobile = response.data.mobile;
		email = response.data.email;
		//pass = response.data.pass;
		mrah = response.data.mrah;
		time = response.data.time;
		marketvalue = response.data.marketvalue;
		if ( response.data.mrahid && response.data.mrahname ) {
			mrahid = response.data.mrahid;
			mrahname = response.data.mrahname;
			
			$( ".title" ).find("h1").html(name);
			$( ".mrahtitle" ).html('مراح '+mrahname);
		} else {
			console.log("not sucess");
			
			setTimeout(function() {    showalert('danger','لم تقم بإختيار المراح');	}, 500);
			setTimeout(function() {    window.location.replace("index.html");	}, 5000);
		}
		
// Fetch Sheep Stats ////////////////////////////////////////////////////////////////////////////////
		var start = new Date().getTime();
		// Fetch Sheep Stats
		$.ajax({
			type: 'POST',
			url    : 'php/stats.php',
			data: ({mobile: 'hi'}),
		})
		.done(function(response) {
			
			var end = new Date().getTime();		console.log('Seconds passed', ((end - start)/1000));
			setTimeout(function() {    $('.loader').modal('hide');	}, 500);
			var j = 0;
			var status = response.id;		
			<!-- var statusmessage = response.message; -->
			if ( status == 'success' ) {
				var sheepnum = response.sheepnum;
				previousprofit = Number(response.previousprofit);
				previousexpense = Number(response.previousexpense);
				var capitallossarr = [];	
					capitallossarr['dead'] = 0 ;	capitallossarr['gifted'] = 0 ;		capitallossarr['killed'] = 0 ;		capitallossarr['sold'] = 0 ;
					capitallossarr['deadcount'] = 0 ;	capitallossarr['giftedcount'] = 0 ;	capitallossarr['killedcount'] = 0 ;		capitallossarr['soldcount'] = 0 ;			<!-- console.log(capitallossarr); -->
					
				if ( sheepnum > 0 ) {
					if ( response[0] !== '' && response[0] !== null && response[0] !== undefined ) {
						for (var i = 0; i < response[0].length; i++) {
							var responsetagc = response[0][i].tagcolor;
							//purchased
							<!-- if (response[0][i].cost !== "") { -->
								<!-- purchasedsheepcount++;		purchasedsheeptotal += Number(response[0][i].cost); -->
							<!-- } -->
							//By status
							
							//By inclusion date not live nor sick
							if (response[0][i].status !== "live" &&	response[0][i].status !== "sick" ) {
								var incdatevalue=response[0][i].inclusiondate;
								if(incdatevalue===''||incdatevalue===null){incdatelessabsent++;}
								else if(incdatevalue<=3){incdate3absent++;}
								else if(incdatevalue<=6){incdate6absent++;}
								else if(incdatevalue<=9){incdate9absent++;}
								else if(incdatevalue<=12){incdate12absent++;}
								else if(incdatevalue<=15){incdate15absent++;}
								else if(incdatevalue<=18){incdate18absent++;}
								else if(incdatevalue<=21){incdate21absent++;}
								else if(incdatevalue<=24){incdate24absent++;}
								else if(incdatevalue<=27){incdate27absent++;}
								else if(incdatevalue<=30){incdate30absent++;}
								else if(incdatevalue<=33){incdate33absent++;}
								else if(incdatevalue<=36){incdate36absent++;}
								else if(incdatevalue<=39){incdate39absent++;}
								else if(incdatevalue<=42){incdate42absent++;}
								else if(incdatevalue<=45){incdate45absent++;}
								else if(incdatevalue<=48){incdate48absent++;}
								else if(incdatevalue<=51){incdate51absent++;}
								else if(incdatevalue<=54){incdate54absent++;}
								else if(incdatevalue<=57){incdate57absent++;}
								else{incdate60absent++;}
							}
							if (response[0][i].status === "dead") {
								dead++;		capitallossarr['dead'] += Number(response[0][i].value);	capitallossarr['deadcount'] += 1;
								(responsetagc === "green")                            ? deadGreen++ :
								(responsetagc === "yellow")                            ? deadYellow++ :
								(responsetagc === "white")                            ? deadWhite++ :
								(["orange","blue","red"].includes(responsetagc))      ? deadBlue++   : null;
							}
							if (response[0][i].status === "gifted") {		
								gifted++;		capitallossarr['gifted'] += Number(response[0][i].value);	capitallossarr['giftedcount'] += 1;
								(responsetagc === "green")                            ? giftedGreen++ :
								(responsetagc === "yellow")                            ? giftedYellow++ :
								(responsetagc === "white")                            ? giftedWhite++ :
								(["orange","blue","red"].includes(responsetagc))      ? giftedBlue++   : null;
							}
							if (response[0][i].status === "killed") {		
								killed++;		capitallossarr['killed'] += Number(response[0][i].value);	capitallossarr['killedcount'] += 1;
								(responsetagc === "green")                            ? killedGreen++ :
								(responsetagc === "yellow")                            ? killedYellow++ :
								(responsetagc === "white")                            ? killedWhite++ :
								(["orange","blue","red"].includes(responsetagc))      ? killedBlue++   : null;
							}
							if (response[0][i].status === "sold") {		
								sold++;		capitallossarr['sold'] += Number(response[0][i].value);	capitallossarr['soldcount'] += 1;
								(responsetagc === "green")                            ? soldGreen++ :
								(responsetagc === "yellow")                            ? soldYellow++ :
								(responsetagc === "white")                            ? soldWhite++ :
								(["orange","blue","red"].includes(responsetagc))      ? soldBlue++   : null;
							}
							if (response[0][i].status === "live" ||	response[0][i].status === "sick" ) {	existingsheep++;
								if (response[0][i].status === "sick") {    sick++;  }
								if (response[0][i].status === "live") {    live++;  }
								//By sex
								<!-- if (response[0][i].gender === "male") {    sheepmale++;  if (response[0][i].age > 5 ) {    sheepram++;  }	} -->
								if (response[0][i].gender === "male") {      if (response[0][i].age > 5 ) {    sheepram++;  } else {	sheepmale++;	}	}
								if (response[0][i].gender === "female") {    sheepfemale++;  }
								//By Breed
								if (response[0][i].breed === "harri") {    harri++;  }
								if (response[0][i].breed === "najdi") {    najdi++;  }
								if (response[0][i].breed === "naimi") {    naimi++;  }
								if (response[0][i].breed === "swakni") {    swakni++;  }
								if (response[0][i].breed === "rufaidi") {    rufaidi++;  }
								if (response[0][i].breed === "assaf") {    assaf++;  }
								if (response[0][i].breed === "awasi") {    awasi++;  }
								if (response[0][i].breed === "barbari") {    barbari++;  }
								if (response[0][i].breed === "habashi") {    habashi++;  }
								if (response[0][i].breed === "droper") {    droper++;  }
								if (response[0][i].breed === "aradi") {    aradi++;  }
								if (response[0][i].breed === "merino") {    merino++;  }
								if (response[0][i].breed === "goat") {    goat++;  }
								if (response[0][i].breed === "other") {    other++;  }
								//By Age
								var agevalue = response[0][i].age;
								
								if (agevalue == 1) {
									sheep1++;
									if (responsetagc === "green") {
										sheep1green++;
									} else if (responsetagc === "yellow") {
										sheep1yellow++;
									} else if (responsetagc === "white") {
										sheep1white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep1blue++;
									}
								} else if (agevalue == 2) {
									sheep2++;
									if (responsetagc === "green") {
										sheep2green++;
									} else if (responsetagc === "yellow") {
										sheep2yellow++;
									} else if (responsetagc === "white") {
										sheep2white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep2blue++;
									}
								} else if (agevalue == 3) {
									sheep3++;
									if (responsetagc === "green") {
										sheep3green++;
									} else if (responsetagc === "yellow") {
										sheep3yellow++;
									} else if (responsetagc === "white") {
										sheep3white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep3blue++;
									}
								} else if (agevalue == 4) {
									sheep4++;
									if (responsetagc === "green") {
										sheep4green++;
									} else if (responsetagc === "yellow") {
										sheep4yellow++;
									} else if (responsetagc === "white") {
										sheep4white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep4blue++;
									}
								} else if (agevalue == 5) {
									sheep5++;
									if (responsetagc === "green") {
										sheep5green++;
									} else if (responsetagc === "yellow") {
										sheep5yellow++;
									} else if (responsetagc === "white") {
										sheep5white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep5blue++;
									}
								} else if (agevalue == 6) {
									sheep6++;
									if (responsetagc === "green") {
										sheep6green++;
									} else if (responsetagc === "yellow") {
										sheep6yellow++;
									} else if (responsetagc === "white") {
										sheep6white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep6blue++;
									}
								} else if (agevalue == 7) {
									sheep7++;
									if (responsetagc === "green") {
										sheep7green++;
									} else if (responsetagc === "yellow") {
										sheep7yellow++;
									} else if (responsetagc === "white") {
										sheep7white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep7blue++;
									}
								} else if (agevalue == 8) {
									sheep8++;
									if (responsetagc === "green") {
										sheep8green++;
									} else if (responsetagc === "yellow") {
										sheep8yellow++;
									} else if (responsetagc === "white") {
										sheep8white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep8blue++;
									}
								} else if (agevalue == 9) {
									sheep9++;
									if (responsetagc === "green") {
										sheep9green++;
									} else if (responsetagc === "yellow") {
										sheep9yellow++;
									} else if (responsetagc === "white") {
										sheep9white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep9blue++;
									}
								} else if (agevalue == 10) {
									sheep10++;
									if (responsetagc === "green") {
										sheep10green++;
									} else if (responsetagc === "yellow") {
										sheep10yellow++;
									} else if (responsetagc === "white") {
										sheep10white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep10blue++;
									}
								} else if (agevalue == 11) {
									sheep11++;
									if (responsetagc === "green") {
										sheep11green++;
									} else if (responsetagc === "yellow") {
										sheep11yellow++;
									} else if (responsetagc === "white") {
										sheep11white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep11blue++;
									}
								} else if (agevalue >= 12 && agevalue <= 24 && agevalue != null && agevalue != 0) {
									sheep12++;
									if (responsetagc === "green") {
										sheep12green++;
									} else if (responsetagc === "yellow") {
										sheep12yellow++;
									} else if (responsetagc === "white") {
										sheep12white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep12blue++;
									}
								} else if (agevalue > 24 && agevalue <= 36 && agevalue != null && agevalue != 0) {
									sheep24++;
									if (responsetagc === "green") {
										sheep24green++;
									} else if (responsetagc === "yellow") {
										sheep24yellow++;
									} else if (responsetagc === "white") {
										sheep24white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep24blue++;
									}
								} else if (agevalue > 36 && agevalue <= 48 && agevalue != null && agevalue != 0) {
									sheep36++;
									if (responsetagc === "green") {
										sheep36green++;
									} else if (responsetagc === "yellow") {
										sheep36yellow++;
									} else if (responsetagc === "white") {
										sheep36white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep36blue++;
									}
								} else if (agevalue > 48 && agevalue <= 60 && agevalue != null && agevalue != 0) {
									sheep48++;
									if (responsetagc === "green") {
										sheep48green++;
									} else if (responsetagc === "yellow") {
										sheep48yellow++;
									} else if (responsetagc === "white") {
										sheep48white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep48blue++;
									}
								} else if (agevalue > 60 && agevalue != null && agevalue != 0) {
									sheep60++;
									if (responsetagc === "green") {
										sheep60green++;
									} else if (responsetagc === "yellow") {
										sheep60yellow++;
									} else if (responsetagc === "white") {
										sheep60white++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheep60blue++;
									}
								} else if (agevalue === '' || agevalue === null || agevalue == 0) {
									sheepagless++;
									if (responsetagc === "green") {
										sheepaglessgreen++;
									} else if (responsetagc === "yellow") {
										sheepaglessyellow++;
									} else if (responsetagc === "white") {
										sheepaglesswhite++;
									} else if (["orange", "blue", "red"].includes(responsetagc)) {
										sheepaglessblue++;
									}
								}

								//By tagcolor
								if (response[0][i].tagcolor === "yellow") {    yellow++;  }
								if (response[0][i].tagcolor === "orange") {    orange++;  }
								if (response[0][i].tagcolor === "blue") {    blue++;  }
								if (response[0][i].tagcolor === "red") {    red++;  }
								if (response[0][i].tagcolor === "green") {    green++;  }
								if (response[0][i].tagcolor === "pink") {    pink++;  }
								if (response[0][i].tagcolor === "white") {    white++;  }
								if (response[0][i].tagcolor === "none" || response[0][i].tagcolor === null || response[0][i].tagcolor === '') {    colorless++;  }
								//By weight
								var weightvalue = response[0][i].weight;
								if (weightvalue === '' || weightvalue === null || weightvalue === 0 ) {    sheepweightless++;  
								} else {
									if (weightvalue <= 5)          { sheepw5++;   }
									if (weightvalue > 5  && weightvalue <= 10)  { sheepw10++;  }
									if (weightvalue > 10 && weightvalue <= 15)  { sheepw15++;  }
									if (weightvalue > 15 && weightvalue <= 20)  { sheepw20++;  }
									if (weightvalue > 20 && weightvalue <= 25)  { sheepw25++;  }
									if (weightvalue > 25 && weightvalue <= 30)  { sheepw30++;  }
									if (weightvalue > 30 && weightvalue <= 35)  { sheepw35++;  }
									if (weightvalue > 35 && weightvalue <= 40)  { sheepw40++;  }
									if (weightvalue > 40 && weightvalue <= 45)  { sheepw45++;  }
									if (weightvalue > 45 && weightvalue <= 50)  { sheepw50++;  }
									if (weightvalue > 50 && weightvalue <= 55)  { sheepw55++;  }
									if (weightvalue > 55 && weightvalue <= 60)  { sheepw60++;  }
									if (weightvalue > 60 && weightvalue <= 65)  { sheepw65++;  }
									if (weightvalue > 65 && weightvalue <= 70)  { sheepw70++;  }
									if (weightvalue > 70 && weightvalue <= 75)  { sheepw75++;  }
									if (weightvalue > 75 && weightvalue <= 80)  { sheepw80++;  }
									if (weightvalue > 80 && weightvalue <= 85)  { sheepw85++;  }
									if (weightvalue > 85 && weightvalue <= 90)  { sheepw90++;  }
									if (weightvalue > 90 && weightvalue <= 95)  { sheepw95++;  }
									if (weightvalue > 95 && weightvalue <= 100){ sheepw100++; }
								}

								//By Cost
								var costvalue = response[0][i].cost;
								if (costvalue === '' || costvalue === null || costvalue === 0 ) {    costless++;  
								} else {
									if (costvalue <= 500) {    			cost500++;
									} else if (costvalue <= 600) {		cost600++;
									} else if (costvalue <= 700) {		cost700++;
									} else if (costvalue <= 800) {		cost800++;
									} else if (costvalue <= 900) {		cost900++;
									} else if (costvalue <= 1000) {		cost1000++;
									} else if (costvalue <= 1100) {		cost1100++;
									} else if (costvalue <= 1200) {		cost1200++;
									} else if (costvalue <= 1300) {		cost1300++;
									} else if (costvalue <= 1400) {		cost1400++;
									} else if (costvalue <= 1500) {		cost1500++;
									} else if (costvalue <= 1600) {		cost1600++;
									} else if (costvalue <= 1700) {		cost1700++;
									} else if (costvalue <= 1800) {		cost1800++;
									} else if (costvalue <= 1900) {		cost1900++;
									} else if (costvalue <= 2000) {		cost2000++;
									} else if (costvalue <= 2100) {		cost2100++;
									} else if (costvalue <= 2200) {		cost2200++;
									} else if (costvalue <= 2300) {		cost2300++;
									} else if (costvalue <= 2400) {		cost2400++;
									} else if (costvalue <= 2500) {		cost2500++;
									} else {    						cost2500plus++;	}
								}
								//By inclusion date
								incdatevalue = response[0][i].inclusiondate;
								if (incdatevalue === '' || incdatevalue === null ) {    incdateless++;  
								} else {
									if (incdatevalue <= 3) {			incdate3++;
									} else if (incdatevalue <= 6) {		incdate6++;
									} else if (incdatevalue <= 9) {		incdate9++;
									} else if (incdatevalue <= 12) {	incdate12++;
									} else if (incdatevalue <= 15) {	incdate15++;
									} else if (incdatevalue <= 18) {	incdate18++;
									} else if (incdatevalue <= 21) {	incdate21++;
									} else if (incdatevalue <= 24) {	incdate24++;
									} else if (incdatevalue <= 27) {	incdate27++;
									} else if (incdatevalue <= 30) {	incdate30++;
									} else if (incdatevalue <= 33) {	incdate33++;
									} else if (incdatevalue <= 36) {	incdate36++;
									} else if (incdatevalue <= 39) {	incdate39++;
									} else if (incdatevalue <= 42) {	incdate42++;
									} else if (incdatevalue <= 45) {	incdate45++;
									} else if (incdatevalue <= 48) {	incdate48++;
									} else if (incdatevalue <= 51) {	incdate51++;
									} else if (incdatevalue <= 54) {	incdate54++;
									} else if (incdatevalue <= 57) {	incdate57++;
									} else {							incdate60++;	}
								}
							}
						}
					}

					newcard = '';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 ">';
					newcard +=     '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=     '<div class="card-header-green text-center text-1 p-1	">';
					newcard +=     'تعداد عام';
					newcard +=     '</div>';
					newcard +=      '<div class="card-body text-center pt-3 pb-3">';
					newcard +=       '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=        '<div class="row stats" style="display:none;">';
					newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">العدد الكلي</span>';
					newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 ma iosspan">'+existingsheep+'</span>';
					newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">رأس</span>';

		//Gender
					const genderBuckets = [
						{ label: "الذكور",     value: sheepmale,   color: "text-c-steelblue", tt: "عدد الذكور بالمجمل بما فيها الفحول" },
						{ label: "الإناث",     value: sheepfemale, color: "text-c-magenta-pink", tt: "عدد الاناث بالمجمل" },
						{ label: "الفحول",     value: sheepram,    color: "text-c-steelblue", tt: "عدد الذكور أكبر من 6  أشهر" }
					];
					
					for (const item of genderBuckets) {
						newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0" data-toggle="tooltip" data-placement="top" title="" data-original-title="${item.tt}">${item.label}</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead ${item.color} text-24 p-0 ma iosspan">${item.value}</span>`;
						
						if (existingsheep > 0) {
							const percent = (item.value / existingsheep * 100).toFixed(1);
							newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
						} else {
							newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
						}
					}
					
		// Health
					if ( sick > 0 ) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">الحاله الصحيه</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبة</span>';
						if ( live > 0 ) {
							newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">الأغنام السليمه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">'+live+'</span>';
							if (existingsheep > 0) {
								newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">'+(live / existingsheep * 100).toFixed(1)+'</span>';
							} else {
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
							}					
						}
						if ( sick > 0 ) {
							newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">الأغنام المريضه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">'+sick+'</span>';
							if (existingsheep > 0) {
								newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">'+(sick / existingsheep * 100).toFixed(1)+'</span>';
							} else {
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
							}
						}
					}
					
		// Breed
					if ( harri != 0 || najdi != 0 || naimi != 0 || swakni != 0 || rufaidi != 0 || assaf != 0 || awasi != 0 || barbari != 0 || habashi != 0 || droper != 0 || aradi != 0 || merino != 0 || goat != 0 || other != 0 ) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">السلالة</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبة</span>';

						const breedBuckets = [
							{ value: harri,    label: "الأغنام الحريه"     },
							{ value: najdi,    label: "الأغنام النجديه"    },
							{ value: naimi,    label: "الأغنام النعيميه"   },
							{ value: swakni,   label: "الأغنام السواكني"   },
							{ value: rufaidi,  label: "الأغنام الرفيدي"    },
							{ value: assaf,    label: "أغنام العساف"       },
							{ value: awasi,    label: "أغنام العواسي"      },
							{ value: barbari,  label: "الأغنام البربريه"   },
							{ value: habashi,  label: "الأغنام الحبشيه"    },
							{ value: droper,   label: "الأغنام الدروبر"    },
							{ value: aradi,    label: "الأغنام العراديه"   },
							{ value: merino,   label: "الأغنام المرينو"    },
							{ value: goat,     label: "الماعز"             },
							{ value: other,    label: "الأغنام الأخرى"     }
						];

						for (const bucket of breedBuckets) {
							if (bucket.value > 0) {
								newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0 ">${bucket.label}</span>`;
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">${bucket.value}</span>`;

								if (existingsheep > 0) {
									const percent = (bucket.value / existingsheep * 100).toFixed(1);
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
								} else {
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
								}
							}
						}
					}

		//Age
					if ( sheep1 !== 0 || sheep2 !== 0 || sheep3 !== 0 || sheep4 !== 0 || sheep5 !== 0 || sheep6 !== 0 || sheep7 !== 0 || sheep8 !== 0 ||	sheep9 !== 0 || sheep10 !== 0 || sheep11 !== 0 || sheep12 !== 0 || sheep24 !== 0 || sheep36 !== 0 || sheep48 !== 0 || sheep60 !== 0 ) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">العمر</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبه</span>';

						// Array of age buckets
						const ageBuckets = [
							{ value: sheep1,      label: "شهر"            },
							{ value: sheep2,      label: "شهرين"          },
							{ value: sheep3,      label: "3 أشهر"         },
							{ value: sheep4,      label: "4 أشهر"         },
							{ value: sheep5,      label: "5 أشهر"         },
							{ value: sheep6,      label: "6 أشهر"         },
							{ value: sheep7,      label: "7 أشهر"         },
							{ value: sheep8,      label: "8 أشهر"         },
							{ value: sheep9,      label: "9 أشهر"         },
							{ value: sheep10,     label: "10 أشهر"        },
							{ value: sheep11,     label: "11 شهر"         },
							{ value: sheep12,     label: "12 شهر"         },
							{ value: sheep24,     label: "بين 1-2 أعوام"  },
							{ value: sheep36,     label: "بين 2-3 أعوام"  },
							{ value: sheep48,     label: "بين 3-4 أعوام"  },
							{ value: sheep60,     label: "أكبر من 4 أعوام"},
							{ value: sheepagless, label: "غير محدد"       }
						];

						for (const bucket of ageBuckets) {
							if (bucket.value > 0) {
								newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0 ">${bucket.label}</span>`;
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">${bucket.value}</span>`;

								if (existingsheep > 0) {
									const percent = (bucket.value / existingsheep * 100).toFixed(1);
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
								} else {
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
								}
							}
						}
					}
					
		// Tag Color
					if (yellow != 0 || orange != 0 || blue != 0 || red != 0 || green != 0 || pink != 0 || white != 0 || colorless != 0) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">اللون</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>';
						newcard += '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبه</span>';
						const colorBuckets = [
							{ value: yellow,    label: "الوسم الأصفر",  colorClass: "text-c-gold"   },
							{ value: orange,    label: "الوسم البرتقالي", colorClass: "text-c-orange" },
							{ value: blue,      label: "الوسم الأزرق",   colorClass: "text-c-blue"   },
							{ value: red,       label: "الوسم الأحمر",   colorClass: "text-c-red"    },
							{ value: green,     label: "الوسم الأخضر",   colorClass: "text-c-green"  },
							{ value: pink,      label: "الوسم الوردي",   colorClass: "text-c-pink"   },
							{ value: white,     label: "الوسم الأبيض",   colorClass: "text-c-silver" },
							{ value: colorless, label: "بلا وسم",        colorClass: "text-muted"    }
						];
						for (const bucket of colorBuckets) {
							if (bucket.value > 0) {
								newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0 ">${bucket.label}</span>`;
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead ${bucket.colorClass} text-24 p-0 ma iosspan">${bucket.value}</span>`;
								if (existingsheep > 0) {
									const percent = (bucket.value / existingsheep * 100).toFixed(1);
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
								} else {
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
								}
							}
						}
					}

		// Weight
					if (sheepw5 || sheepw10 || sheepw15 || sheepw20 || sheepw25 || sheepw30 || sheepw35 || sheepw40 || sheepw45 || sheepw50 || sheepw55 || sheepw60 || sheepw65 || sheepw70 || sheepw75 || sheepw80 || sheepw85 || sheepw90 || sheepw95 || sheepw100) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">الوزن</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبه</span>`;

						const weightBuckets = [
							{ value: sheepw5,    label: "< 5 كجم"      },
							{ value: sheepw10,   label: "5-10 كجم"     },
							{ value: sheepw15,   label: " 10-15 كجم"     },
							{ value: sheepw20,   label: "15-20 كجم"     },
							{ value: sheepw25,   label: "20-25 كجم"     },
							{ value: sheepw30,   label: "20-30 كجم"     },
							{ value: sheepw35,   label: "30-35 كجم"     },
							{ value: sheepw40,   label: "35-40 كجم"     },
							{ value: sheepw45,   label: "40-45 كجم"     },
							{ value: sheepw50,   label: "45-50 كجم"     },
							{ value: sheepw55,   label: "50-55 كجم"     },
							{ value: sheepw60,   label: "55-60 كجم"     },
							{ value: sheepw65,   label: "60-65 كجم"     },
							{ value: sheepw70,   label: "65-70 كجم"     },
							{ value: sheepw75,   label: "70-75 كجم"     },
							{ value: sheepw80,   label: "75-80 كجم"     },
							{ value: sheepw85,   label: "80-85 كجم"     },
							{ value: sheepw90,   label: "85-90 كجم"     },
							{ value: sheepw95,   label: "90-95 كجم"     },
							{ value: sheepw100,  label: "> 95 كجم"    },
							{ value: sheepweightless, label: "غير محدد" }
						];

						for (const bucket of weightBuckets) {
							if (bucket.value > 0) {
								newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0 ">${bucket.label}</span>`;
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">${bucket.value}</span>`;

								if (existingsheep > 0) {
									const percent = (bucket.value / existingsheep * 100).toFixed(1);
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
								} else {
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
								}
							}
						}
						
					}
					
		// Cost
					if ( cost500 > 0 || cost600 > 0 || cost700 > 0 || cost800 > 0 || cost900 > 0 || cost1000 > 0 || cost1100 > 0 ||    cost1200 > 0 || cost1300 > 0 || cost1400 > 0 || cost1500 > 0 || cost1600 > 0 || cost1700 > 0 || cost1800 > 0 || cost1900 > 0 ||    cost2000 > 0 || cost2100 > 0 || cost2200 > 0 || cost2300 > 0 || cost2400 > 0 || cost2500 > 0 || cost2500plus > 0) { 
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">سعر الشراء</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبه</span>`;
						const costItems = [
							{ var: costless,     label: "غير محدد"     },
							{ var: cost500,      label: "500 ريال"            },
							{ var: cost600,      label: "600 ريال"            },
							{ var: cost700,      label: "700 ريال"            },
							{ var: cost800,      label: "800 ريال"            },
							{ var: cost900,      label: "900 ريال"            },
							{ var: cost1000,     label: "1000 ريال"           },
							{ var: cost1100,     label: "1100 ريال"           },
							{ var: cost1200,     label: "1200 ريال"           },
							{ var: cost1300,     label: "1300 ريال"           },
							{ var: cost1400,     label: "1400 ريال"           },
							{ var: cost1500,     label: "1500 ريال"           },
							{ var: cost1600,     label: "1600 ريال"           },
							{ var: cost1700,     label: "1700 ريال"           },
							{ var: cost1800,     label: "1800 ريال"           },
							{ var: cost1900,     label: "1900 ريال"           },
							{ var: cost2000,     label: "2000 ريال"           },
							{ var: cost2100,     label: "2100 ريال"           },
							{ var: cost2200,     label: "2200 ريال"           },
							{ var: cost2300,     label: "2300 ريال"           },
							{ var: cost2400,     label: "2400 ريال"           },
							{ var: cost2500,     label: "2500 ريال"           },
							{ var: cost2500plus, label: "> 2500 ريال"  }
						];
						for (const item of costItems) {
							if (item.var > 0) {
								newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0 ">${item.label}</span>`;
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">${item.var}</span>`;
								if (existingsheep > 0) {
									const percent = (item.var / existingsheep * 100).toFixed(1);
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
								} else {
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
								}
							}
						}								
					}
					
					if (incdate3 != 0 || incdate6 != 0 || incdate9 != 0 || incdate12 != 0 || incdate15 != 0 || incdate18 || incdate21 != 0 || incdate24 != 0 || incdate27 != 0 || incdate30 != 0 || incdate33 != 0 || incdate36 != 0 || incdate39 != 0 || incdate42 != 0 || incdate45 != 0 || incdate48 || incdate51 != 0 || incdate54 != 0 || incdate57 != 0 || incdate60 != 0   ) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">فترة الضم</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبه</span>`;
						
						const incdateBuckets = [
							{ value: incdate3,     months: 3,  label: "خلال 3 أشهر"       },
							{ value: incdate6,     months: 6,  label: "3-6 أشهر" },
							{ value: incdate9,     months: 9,  label: "6-9 أشهر" },
							{ value: incdate12,    months: 12, label: "9-12 شهراً" },
							{ value: incdate15,    months: 15, label: "12-15 شهراً" },
							{ value: incdate18,    months: 18, label: "15-18 شهراً" },
							{ value: incdate21,    months: 21, label: "18-21 شهراً" },
							{ value: incdate24,    months: 24, label: "21-24 شهراً" },
							{ value: incdate27,    months: 27, label: "24-27 شهراً" },
							{ value: incdate30,    months: 30, label: "27-30 شهراً" },
							{ value: incdate33,    months: 33, label: "30-33 شهراً" },
							{ value: incdate36,    months: 36, label: "33-36 شهراً" },
							{ value: incdate39,    months: 39, label: "36-39 شهراً" },
							{ value: incdate42,    months: 42, label: "39-42 شهراً" },
							{ value: incdate45,    months: 45, label: "42-45 شهراً" },
							{ value: incdate48,    months: 48, label: "45-48 شهراً" },
							{ value: incdate51,    months: 51, label: "48-51 شهراً" },
							{ value: incdate54,    months: 54, label: "51-54 شهراً" },
							{ value: incdate57,    months: 57, label: "54-57 شهراً" },
							{ value: incdate60,    months: 60, label: "أ57 شهرا فأكثر" },
							{ value: incdateless,  months: 0,  label: "غير محدد"          },
						];

						for (const bucket of incdateBuckets) {
							if (bucket.value > 0) {
								newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1 mb-0 p-0 ">${bucket.label}</span>`;
								newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">${bucket.value}</span>`;

								if (existingsheep > 0) {
									const percent = (bucket.value / existingsheep * 100).toFixed(1);
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">%${percent}</span>`;
								} else {
									newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan"></span>`;
								}
							}
						}
						
					}
					
					if (killed != 0 || sold != 0 || gifted != 0 || dead != 0  ) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard += `<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-dark text-1 mb-0 p-0 ">نوع التصريف</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">العدد</span>`;
						newcard += `<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-dark text-1 mb-0 p-0 ">النسبه</span>`;
						if ( killed > 0 ) {
							newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">مذبوحه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-green text-24 p-0 ma iosspan">'+killed+'</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">رأس</span>';
						}
						if ( sold > 0 ) {
							newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">مباعه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-steelblue text-24 p-0 ma iosspan">'+sold+'</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">رأس</span>';
						}
						if ( gifted > 0 ) {
							newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">مهداه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-magenta-pink text-24 p-0 ma iosspan">'+gifted+'</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">رأس</span>';
						}
						if ( dead > 0 ) {
							newcard +=         '<span class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-muted text-1  mb-0 p-0 ">نافقه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-magenta-pink text-24 p-0 ma iosspan">'+dead+'</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 lead text-c-silver text-1 p-0 ma iosspan">رأس</span>';
						}
					}
					
					newcard +=        '</div>';
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
		//Gender Chart Code
					const genders = [sheepmale, sheepfemale, sheepram];
					if (genders.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						<!-- newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>'; -->
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="genderchart"></canvas>';
					newcard +=         '</div>';
		//Health Chart Code
					newcard += 			'<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1 ' + (sick > 0 ? '' : 'hidden') + '"></div>';
					newcard += 			 '<div class="chart-container ma maxwidth ' + (sick > 0 ? '' : 'hidden') + '">';
					newcard += 			  '    <canvas id="healthchart"></canvas>';
					newcard += 			 '</div>';
		//Breed Chart Code
					const breeds = [harri, najdi, naimi, swakni, rufaidi, assaf, awasi, barbari, habashi, droper, aradi, merino, goat, other];
					if (breeds.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="breedchart" ></canvas>';
					newcard +=         '</div>';
		//Tag Color Chart Code
					const colors = [yellow, orange, blue, red, green, pink, white, colorless];
					if (colors.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="tagcolorchart"></canvas>';
					newcard +=         '</div>';
		//Age Chart Code
					const ages = [sheep1, sheep2, sheep3, sheep4, sheep5, sheep6, sheep7, sheep8, sheep9, sheep10, sheep11, sheep12, sheep24, sheep36, sheep48, sheep60, sheepagless];
					if (ages.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="agechart"></canvas>';
					newcard +=         '</div>';
		//Weight Chart Code
					const weights = [sheepw5, sheepw10, sheepw15, sheepw20, sheepw25, sheepw30, sheepw35, sheepw40, sheepw45, sheepw50, sheepw55, sheepw60, sheepw65, sheepw70, sheepw75, sheepw80, sheepw85, sheepw90, sheepw95, sheepw100, sheepweightless];
					if (weights.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="weightchart"></canvas>';
					newcard +=         '</div>';
		//Cost Chart Code
					const costs=[costless,cost500,cost600,cost700,cost800,cost900,cost1000,cost1100,cost1200,cost1300,cost1400,cost1500,cost1600,cost1700,cost1800,cost1900,cost2000,cost2100,cost2200,cost2300,cost2400,cost2500,cost2500plus];
					if (costs.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="costchart"></canvas>';
					newcard +=         '</div>';
		//Inclusion Date Chart Code
					const incdates=[incdateless,incdate3,incdate6,incdate9,incdate12,incdate15,incdate18,incdate21,incdate24,incdate27,incdate30,incdate33,incdate36,incdate39,incdate42,incdate45,incdate48,incdate51,incdate54,incdate57,incdate60];
					if (incdates.filter(w => w > 0).length >= 2) {	// if atleast two are < zero
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="inclusionchart"></canvas>';
					newcard +=         '</div>';
		//Status Chart Code
					if (killed != 0 || sold != 0 || gifted != 0 || dead != 0  ) {
						newcard +=         '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="statuschart"></canvas>';
					newcard +=         '</div>';

					newcard +=        '</div>';

					<!-- if ([genders, breeds, colors, ages, weights, costs, incdates].some(arr => arr.filter(x => x < 0).length >= 2 ) ) {	} else {				 -->
						<!-- if (killed != 0 || sold != 0 || gifted != 0 || dead != 0  ) {	} else { -->
							<!-- newcard +=         '<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-muted text-1  mb-0 p-0 ">لايوجد بيانات كافيه لعرضها</span>'; -->
						<!-- } -->
					<!-- } -->
					
					newcard +=       '</div>';
					newcard +=      '</div>';
					newcard +=     '</div>';
					newcard +=   '</div>';
					newcard +=   '</div>';
					$('.card-columns').append(newcard);						
					j++;
					
					if ([genders, breeds, colors, ages, weights, costs, incdates].some(arr => arr.filter(x => x < 0).length >= 2 ) ) {	} else {				
						if (killed != 0 || sold != 0 || gifted != 0 || dead != 0  ) {	} else {
							$('.row.graphs').first().append('<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-muted text-1  mb-0 p-0 ">لايوجد بيانات كافيه لعرضها</span>');
						}
					}

		// Gender Chart
					const genderchart = document.getElementById('genderchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(genderchart, {
					  type: 'doughnut',  
					  data: {
						labels: ['الذكور','الاناث','الفحول'],
						datasets: [{
						  label: 'العدد',
						  data: [sheepmale, sheepfemale, sheepram],
						  backgroundColor: ['#2986cc','#c90076','#16496f' ],
						  borderColor: ['#2986cc','#c90076','#16496f' ],
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						<!-- maintainAspectRatio: true, -->
						responsive: true,
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {
							display: true,
							text: 'حسب الجنس',
							font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							color: '#1e293b', 
							padding: {  top: 5,	  bottom: 5	},
							align: 'center'
						  },
						// Simple data labels configuration
						  datalabels: {
							color: getContrastColor,
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  if (value === 0) {	return '';	}
							  let sum = 0;
							  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  return value + '\n(' + percentage + '%)';
							},
							anchor: 'center',
							align: 'center',
							<!-- display: (context) => { -->
								<!-- const value = context.dataset.data[context.dataIndex]; -->
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
							  <!-- }, -->
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'رأس',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});
					
		// Health Chart
					const healthchart = document.getElementById('healthchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(healthchart, {
					  type: 'doughnut',  
					  data: {
						labels: ['السليمه','المريضه'],
						datasets: [{
						  label: 'العدد',
						  data: [live, sick],
						  backgroundColor: ['#208e4e','#e74c3c ' ],
						  borderColor: ['#208e4e','#e74c3c ' ],
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						<!-- maintainAspectRatio: true, -->
						responsive: true,
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {
							display: true,
							text: 'حسب الحاله الصحيه',
							font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							color: '#1e293b', 
							padding: {  top: 5,	  bottom: 5	},
							align: 'center'
						  },

						// Simple data labels configuration
						  datalabels: {
							color: getContrastColor,
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  let sum = 0;
							  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  return value + '\n(' + percentage + '%)';
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								const sum = context.dataset.data.reduce((a, b) => a + b, 0);
								return (value / sum) * 100 > 10;   // Only show if slice > 8%
							  },
						  },				
							tooltip: {
								displayColors: false,
								xAlign: 'center',
								yAlign: 'bottom',
								titleAlign: 'center',
								bodyAlign: 'center',
								cornerRadius: 8,
								padding: 10,
								titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							  // remove / change the little arrow/caret
							  caretPadding: 10,
							  caretSize: 6,
							  callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
							  }
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'رأس',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});
					
		// Breed Chart
					// Arabic names (in same order)
					let labelsArabic = ['حري', 'نجدي', 'نعيمي', 'سواكني', 'رفيدي', 'عساف','عواسي', 'بربري', 'حبشي', 'دروبر', 'عرادي', 'ميرينو','ماعز', 'أخرى'];
					// Build data + labels dynamically (only > 0)
					let dataValues = [];			let dataLabels = [];
					[  harri, najdi, naimi, swakni, rufaidi, assaf,  awasi, barbari, habashi, droper, aradi, merino,  goat, other ].forEach((count, index) => {
					  if (count > 0) {	dataValues.push(count);		dataLabels.push(labelsArabic[index]);  }
					});
					const breedchart = document.getElementById('breedchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(breedchart, {
					  type: 'doughnut',  
					  data: {
						labels: dataLabels,
						datasets: [{
						  label: 'العدد',
						  data: dataValues,
						  backgroundColor: ['#c42919','#0ba94e','#1175b8','#cea100','#783693','#c35b00','#dc4691','#009979','#0099b1','#aab916','#1c2e92','#6a4b40'],
						  borderColor: ['#c42919','#0ba94e','#1175b8','#cea100','#783693','#c35b00','#dc4691','#009979','#0099b1','#aab916','#1c2e92','#6a4b40'],
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
							title: {
								display: true,
								text: 'حسب الصنف',
								font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
								color: '#1e293b', 
								padding: {  top: 5,	  bottom: 5	},
								align: 'center'
							},
						// Simple data labels configuration
						  datalabels: {
							color: getContrastColor,
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  let sum = 0;
							  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  return value + '\n(' + percentage + '%)';
							},
							anchor: 'center',
							align: 'center',
							<!-- display: (context) => { -->
								<!-- // Hide labels on very small segments (< 8% for example) -->
								<!-- const value = context.dataset.data[context.dataIndex]; -->
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
							<!-- }, -->
						  },
							tooltip: {
								displayColors: false,
								xAlign: 'center',
								yAlign: 'bottom',
								titleAlign: 'center',
								bodyAlign: 'center',
								cornerRadius: 8,
								padding: 10,
								titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							  // remove / change the little arrow/caret
							  caretPadding: 10,
							  caretSize: 6,
							  callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
							  }
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'رأس',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }

						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});	
					
		// tagcolor Chart
					// Arabic names (in same order)
					labelsArabic = ['أصفر', 'برتقالي', 'أزرق', 'أحمر', 'أخضر', 'وردي', 'أبيض','بدون لون'];
					backgroundColor = ['#e6c200','#e67e22','#3498db','#e74c3c','#2ecc71 ','#ff69b4','#95a5a6','#e2e2e2 '];
					// Build data + labels dynamically (only > 0)
					dataValues = [];			dataLabels = [];			datacolors = [];
					[yellow, orange, blue, red, green, pink,  white, colorless].forEach((count, index) => {
					  if (count > 0) {	dataValues.push(count);		dataLabels.push(labelsArabic[index]);	datacolors.push(backgroundColor[index]);  }
					});
					const tagcolorchart = document.getElementById('tagcolorchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(tagcolorchart, {
					  type: 'doughnut',  
					  data: {
						labels: dataLabels,
						datasets: [{
						  label: 'العدد',
						  data: dataValues,
						  backgroundColor: datacolors,
						  borderColor: datacolors,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						<!-- maintainAspectRatio: true, -->
						responsive: true,
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
							title: {
								display: true,
								text: 'حسب لون الوسم',
								font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
								color: '#1e293b', 
								padding: {  top: 5,	  bottom: 5	},
								align: 'center'
							},

						// Simple data labels configuration
						  datalabels: {
							color: getContrastColor,
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  let sum = 0;
							  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  return value + '\n(' + percentage + '%)';
							},
							anchor: 'center',
							align: 'center',
							<!-- display: (context) => { -->
								<!-- // Hide labels on very small segments (< 8% for example) -->
								<!-- const value = context.dataset.data[context.dataIndex]; -->
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
							<!-- }, -->
						  },				
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							  // remove / change the little arrow/caret
							  caretPadding: 10,
							  caretSize: 6,
							  callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
							  }
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'رأس',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});	
					
		// Age Chart
				if ( userid == 1 || userid > 1000 ) {	console.log('user is 1');
					// ─── Labels (same as before) ───
					const labelsArabic = [
					  'شهر', 'شهرين', '3 أشهر', '4 أشهر', '5 أشهر', '6 أشهر',
					  '7 أشهر', '8 أشهر', '9 أشهر', '10 أشهر', '11 شهر', 'عام',
					  'عامين', '3 أعوام', '4 أعوام', '5 أعوام', 'غير محدد'
					];

					// ─── Colors — one per group (not per bar anymore) ───
					const COLORS = {
					  yellow: '#f1c40f',
					  white:  '#999999',
					  green:  '#2ecc71',
					  blue:   '#3498db'
					};

					// ─── Prepare three arrays for the three stacks ───
					const dataYellow  = [];
					const dataWhite  = [];
					const dataGreen   = [];
					const dataBlue    = [];
					const dataLabels  = [];

					// Order must match labelsArabic
					const ageGroups = [
					  { y: sheep1yellow,   g: sheep1green,   b: sheep1blue,   w: sheep1white   },
					  { y: sheep2yellow,   g: sheep2green,   b: sheep2blue,   w: sheep2white   },
					  { y: sheep3yellow,   g: sheep3green,   b: sheep3blue,   w: sheep3white   },
					  { y: sheep4yellow,   g: sheep4green,   b: sheep4blue,   w: sheep4white   },
					  { y: sheep5yellow,   g: sheep5green,   b: sheep5blue,   w: sheep5white   },
					  { y: sheep6yellow,   g: sheep6green,   b: sheep6blue,   w: sheep6white   },
					  { y: sheep7yellow,   g: sheep7green,   b: sheep7blue,   w: sheep7white   },
					  { y: sheep8yellow,   g: sheep8green,   b: sheep8blue,   w: sheep8white   },
					  { y: sheep9yellow,   g: sheep9green,   b: sheep9blue,   w: sheep9white   },
					  { y: sheep10yellow,  g: sheep10green,  b: sheep10blue,  w: sheep10white  },
					  { y: sheep11yellow,  g: sheep11green,  b: sheep11blue,  w: sheep11white  },
					  { y: sheep12yellow,  g: sheep12green,  b: sheep12blue,  w: sheep12white  },
					  { y: sheep24yellow,  g: sheep24green,  b: sheep24blue,  w: sheep24white  },
					  { y: sheep36yellow,  g: sheep36green,  b: sheep36blue,  w: sheep36white  },
					  { y: sheep48yellow,  g: sheep48green,  b: sheep48blue,  w: sheep48white  },
					  { y: sheep60yellow,  g: sheep60green,  b: sheep60blue,  w: sheep60white  },
					  { y: sheepaglessyellow, g: sheepaglessgreen, b: sheepaglessblue, w: sheepaglesswhite }
					];
					// skip zero values 
					<!-- ageGroups.forEach((group, i) => { -->
					  <!-- const total = group.y + group.g + group.b; -->
					  <!-- if (total > 0) { -->
						<!-- dataYellow.push(group.y); -->
						<!-- dataGreen.push(group.g); -->
						<!-- dataBlue.push(group.b); -->
						<!-- dataLabels.push(labelsArabic[i]); -->
					  <!-- } -->
					<!-- }); -->
					
					ageGroups.forEach((group, i) => {
					  // Always push — even if everything is zero
					  dataYellow.push(group.y  || 0);
					  dataWhite.push (group.w  || 0);
					  dataGreen.push (group.g  || 0);
					  dataBlue.push  (group.b  || 0);
					  dataLabels.push(labelsArabic[i]);
					});

					// ─── Only keep groups that have at least one sheep ───
					const barCount = dataLabels.length;

					// ─── Dynamic height (tune MIN_HEIGHT_PER_BAR if needed) ───
					const MIN_HEIGHT_PER_BAR = 40;   // ← 38–55 usually good for Arabic
					const EXTRA_SPACE = 50;          // title + legend + padding
					const calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					$('#agechart').parent().css('height', calculatedHeight + 'px');

					// ─── Chart ───
					const ctx = document.getElementById('agechart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(ctx, {
					  type: 'bar',
					  data: {
						labels: dataLabels,
						datasets: [
						  {
							label: 'أصفر',
							data: dataYellow,
							backgroundColor: COLORS.yellow,
							borderColor: COLORS.yellow,
							borderWidth: 1,
							borderRadius: 4,
							stack: 'Stack 0',   // all three share same stack
						  },
						  {
							label: 'أبيض',
							data: dataWhite,
							backgroundColor: COLORS.white,
							borderColor: COLORS.white,
							borderWidth: 1,
							borderRadius: 4,
							stack: 'Stack 0',   // all three share same stack
						  },
						  {
							label: 'أزرق',
							data: dataBlue,
							backgroundColor: COLORS.blue,
							borderColor: COLORS.blue,
							borderWidth: 1,
							borderRadius: 4,
							stack: 'Stack 0',
						  },
						  {
							label: 'أخضر',
							data: dataGreen,
							backgroundColor: COLORS.green,
							borderColor: COLORS.green,
							borderWidth: 1,
							borderRadius: 4,
							stack: 'Stack 0',
						  }
						]
					  },
					  options: {
						indexAxis: 'y',               // horizontal bars
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
						  legend: {
							display: true,
							position: 'top',
							labels: {
							  font: { size: 16, weight: 'bold' },
							  boxWidth: 20,
							  padding: 16
							}
						  },
						  title: {
							display: true,
							text: 'حسب العمر',
							font: { size: 20, weight: 'bold' },
							color: '#1e293b',
							padding: { top: 8, bottom: 12 }
						  },
						  tooltip: {
							displayColors: true,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							footerFont: { size: 20, family: 'Tajawal, sans-serif' },
							mode: 'index',
							intersect: false,
							axis: 'y',               // ← add this
							position: 'nearest',     // ← helps a lot with horizontal bars
							callbacks: {
								label: (ctx) => {
									return `${ctx.dataset.label}: ${ctx.raw} رأس`;
								},
								footer: (tooltipItems) => {
									if (tooltipItems.length === 0) return '';
									const sum = tooltipItems.reduce((total, item) => {
										return total + (item.raw || 0);
									}, 0);
									return `المجموع: ${sum} رأس`;
								},
								footerFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								footerColor: '#2ecc71',   // example: green
								<!-- footerMarginTop: 8, -->
								<!-- footerSpacing: 4 -->
							}
						  },
						  datalabels: {
							display: (context) => context.dataset.data[context.dataIndex] > 0,
							<!-- color: '#000', -->
							color: getContrastColor,
							font: { weight: 'bold', size: 16 },
							<!-- formatter: (value) => value > 4 ? value : '',   // hide very small numbers -->
							formatter: (value) => value,   // hide very small numbers
							offset: 1,
							anchor: 'center',
							align: (context) => {	// Fix vertical allignement in IOS
								const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
								return isIOS ? 10 : 2;   // ← 10 degrees on iOS, 0 on others
							},
						  },
						  
						},
						scales: {
						  x: {
							stacked: true,
							beginAtZero: true,
							display: true,
							title: {
							  display: true,
							  text: 'عدد الرؤوس',
							  font: { size: 15 }
							}
						  },
						  y: {
							stacked: true,
							grid: { display: false },
							ticks: {
							  font: { size: 15, weight: '500' },
							  autoSkip: false,
							  maxRotation: 0,
							  minRotation: 0
							}
						  }
						}
					  }
					});
				} else {
					labelsArabic = ['شهر', 'شهرين', '3 أشهر', '4 أشهر', '5 أشهر', '6 أشهر','7 أشهر', '8 أشهر', '9 أشهر', '10 أشهر', '11 شهر', 'عام','عامين', '3 أعوام', '4 أعوام', '5 أعوام', 'غير محدد'];
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b'];

					dataValues = [];			dataLabels = [];			datacolors = [];
					[ sheep1, sheep2, sheep3, sheep4, sheep5, sheep6, sheep7, sheep8, sheep9, sheep10,
					  sheep11, sheep12, sheep24, sheep36, sheep48, sheep60, sheepagless ].forEach((count, index) => {
					  if (count > 0) {		dataValues.push(count);			dataLabels.push(labelsArabic[index]);		datacolors.push(backgroundColor[index]);	  }
					});

					// ─── Dynamic height calculation ───
					MIN_HEIGHT_PER_BAR = 35;     // ← tune this: 45–65px recommended for Arabic + padding
					EXTRA_SPACE        = 35;    // title + legend space + padding + axis labels

					let barCount = dataValues.length; // ← number of visible bars
					let calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					// Apply height to wrapper
					$('#agechart').parent().css('height', calculatedHeight + 'px');

					const agechart = document.getElementById('agechart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(agechart, {
					  type: 'bar',
					  data: {
						labels: dataLabels,
						datasets: [{
						  label: 'العدد',
						  data: dataValues,
						  backgroundColor: datacolors,
						  borderColor: datacolors,
						  borderWidth: 1,
						  borderRadius: 6,
						  hoverBackgroundColor: '#ffffff33'
						}]
					  },
					  options: {
						indexAxis: 'y',                    // ← Makes it horizontal
						responsive: true,
						maintainAspectRatio: false,        // Allows full height usage
						layout: {
						  padding: { top: 0, bottom: 0, left: 0, right: 0 }  // More left space for long Arabic labels
						},
						plugins: {
							legend: {	display: false  },
							title: {
								display: true,
								text: 'حسب العمر',
								font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
								color: '#1e293b', 
								padding: {  top: 5,	  bottom: 5	},
								align: 'center'
							},
							datalabels: {
								anchor: 'end',
								align: (context) => {
								  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
								  if (!isIOS) {
									return 0;
								  }
								  const value = context.dataset.data[context.dataIndex];
								  const maxValue = Math.max(...context.dataset.data);
								  if (maxValue === 0) {
									return 2; // or 0 — your choice for empty/zero chart
								  }
								  const fiftyPercentOfMax = maxValue * 0.5;
								  return value > fiftyPercentOfMax ? 15 : 2;
								},
								offset: (context) => {
								  const value = context.dataset.data[context.dataIndex];
								  const maxValue = Math.max(...context.dataset.data);
								  if (maxValue === 0) return 10;
								  const fiftyPercentOfMax = maxValue * 0.5;
								  if (value > fiftyPercentOfMax) {
									return -5;   // long bars (>50% of max) → pull label left/inside
								  } else {
									return 60;    // short or equal ≤50% → push label far right
								  }
								},	
								font: { weight: 'bold', size: 16 },
								<!-- formatter: (value) => value, -->
								formatter: (value, ctx) => {
								  let sum = 0;
								  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
								  const percentage = Math.round((value / sum) * 100);
								  <!-- return value + '(' + percentage + '%)'; -->
								  return '(' + percentage + '%) ' + value;
								},
								color: (context) => {
								  const data = context.dataset.data;
								  const value = data[context.dataIndex];
								  const max = Math.max(...data);
								  if (max === 0 || value <= max * 0.5) {
									return '#000000';
								  }
								  let bg = context.dataset.backgroundColor?.[context.dataIndex] 
										?? context.dataset.backgroundColor;
								  if (!bg?.startsWith?.('#')) return '#ffffff';
								  const hex = bg.replace(/^#/, '').length === 3
									? bg.replace(/#(.)/g, '#$1$1').slice(1)
									: bg.slice(1);
								  if (hex.length !== 6) return '#ffffff';
								  const rgb = [0,2,4].map(i => parseInt(hex.slice(i, i+2), 16));
								  const brightness = rgb[0]*0.299 + rgb[1]*0.587 + rgb[2]*0.114;
								  return brightness > 145 ? '#000000' : '#ffffff';
								},
							},
							tooltip: {
								displayColors: false,
								xAlign: 'center',
								yAlign: 'bottom',
								titleAlign: 'center',
								bodyAlign: 'center',
								cornerRadius: 8,
								padding: 10,
								titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
								// remove / change the little arrow/caret
								caretPadding: 10,
								caretSize: 6,
								callbacks: {
									label: (context) => {
									  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
									  let perc = Math.round((context.raw / sum) * 100);
									  return `${context.raw} (${perc}%)`;
									}
								}

							  }
						},
						scales: {
						  x: {
							display: false,
							beginAtZero: true,
						  },
						  y: {
							grid: {	  display: false  },
							ticks: {
							  font: {  size: 16,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							  autoSkip: false,
							  maxRotation: 0,
							  minRotation: 0
							},
							border: {
							  display: true  // Keeps the axis line
							}
						  }
						},
					  }
					});			
				}

		// Weight Chart
					labelsArabic = ["أقل من 5 كجم","5-10 كجم","10-15 كجم","15-20 كجم","20-25 كجم","25-30 كجم","30-35 كجم","35-40 كجم","40-45 كجم","45-50 كجم","50-55 كجم","55-60 كجم","60-65 كجم","65-70 كجم","70-75 كجم","75-80 كجم","80-85 كجم","85-90 كجم","90-95 كجم","أكثر من 95 كجم","غير محدد"];
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b'];

					dataValues = [];			dataLabels = [];			datacolors = [];
					[sheepw5,sheepw10,sheepw15,sheepw20,sheepw25,sheepw30,sheepw35,sheepw40,sheepw45,sheepw50,sheepw55,sheepw60,sheepw65,sheepw70,sheepw75,sheepw80,sheepw85,sheepw90,sheepw95,sheepw100,sheepweightless].forEach((count,index)=>{
					  if (count > 0) {	dataValues.push(count);		dataLabels.push(labelsArabic[index]);	datacolors.push(backgroundColor[index]);	}
					});

					barCount = dataValues.length; // ← number of visible bars
					calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					// Apply height to wrapper
					$('#weightchart').parent().css('height', calculatedHeight + 'px');

					const weightchart = document.getElementById('weightchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(weightchart, {
					  type: 'bar',
					  data: {
						labels: dataLabels,
						datasets: [{
						  label: 'العدد',
						  data: dataValues,
						  backgroundColor: datacolors,
						  borderColor: datacolors,
						  borderWidth: 1,
						  borderRadius: 6,
						  <!-- hoverBackgroundColor: '#ffffff33' -->
						}]
					  },
					  options: {
						indexAxis: 'y',                    // ← Makes it horizontal
						responsive: true,
						maintainAspectRatio: false,        // Allows full height usage
						layout: {
						  padding: { top: 0, bottom: 0, left: 0, right: 0 }  // More left space for long Arabic labels
						},
						plugins: {
						legend: {	display: false  },
						title: {
							display: true,
							text: 'حسب الوزن',
							font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							color: '#1e293b', 
							padding: {  top: 5,	  bottom: 5	},
							align: 'center'
						},
						datalabels: {
							anchor: 'end',
							align: (context) => {
							  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
							  if (!isIOS) {
								return 0;
							  }
							  const value = context.dataset.data[context.dataIndex];
							  const maxValue = Math.max(...context.dataset.data);
							  if (maxValue === 0) {
								return 2; // or 0 — your choice for empty/zero chart
							  }
							  const fiftyPercentOfMax = maxValue * 0.5;
							  return value > fiftyPercentOfMax ? 15 : 2;
							},
							offset: (context) => {
							  const value = context.dataset.data[context.dataIndex];
							  const maxValue = Math.max(...context.dataset.data);
							  if (maxValue === 0) return 10;
							  const fiftyPercentOfMax = maxValue * 0.5;
							  if (value > fiftyPercentOfMax) {
								return -5;   // long bars (>50% of max) → pull label left/inside
							  } else {
								return 60;    // short or equal ≤50% → push label far right
							  }
							},	
							color: (context) => {
							  const data = context.dataset.data;
							  const value = data[context.dataIndex];
							  const max = Math.max(...data);
							  if (max === 0 || value <= max * 0.5) {
								return '#000000';
							  }
							  // Only high values → contrast from background
							  let bg = context.dataset.backgroundColor?.[context.dataIndex] 
									?? context.dataset.backgroundColor;
							  if (!bg?.startsWith?.('#')) return '#ffffff';
							  const hex = bg.replace(/^#/, '').length === 3
								? bg.replace(/#(.)/g, '#$1$1').slice(1)
								: bg.slice(1);
							  if (hex.length !== 6) return '#ffffff';
							  const rgb = [0,2,4].map(i => parseInt(hex.slice(i, i+2), 16));
							  const brightness = rgb[0]*0.299 + rgb[1]*0.587 + rgb[2]*0.114;
							  return brightness > 145 ? '#000000' : '#ffffff';
							},
							font: { weight: 'bold', size: 16 },
							<!-- formatter: (value) => value, -->
							formatter: (value, ctx) => {
							  let sum = 0;
							  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  <!-- return value + '(' + percentage + '%)'; -->
							  return '(' + percentage + '%) ' + value;
							},			
						},
						tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
							}

						  }	
						},
						scales: {
						  x: {
							display: false,
							beginAtZero: true,
						  },
						  y: {
							grid: {	  display: false  },
							ticks: {
							  font: {  size: 16,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							  autoSkip: false,
							  maxRotation: 0,
							  minRotation: 0
							},
							border: {
							  display: true  // Keeps the axis line
							}
						  }
						},
					  }
					});	

		// Cost Chart
					labelsArabic = ["500 ريال","600 ريال","700 ريال","800 ريال","900 ريال","1000 ريال","1100 ريال","1200 ريال","1300 ريال","1400 ريال","1500 ريال","1600 ريال","1700 ريال","1800 ريال","1900 ريال","2000 ريال","2100 ريال","2200 ريال","2300 ريال","2400 ريال","2500 ريال","أكثر من 2500","غير محدد"];
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					dataValues = [];			dataLabels = [];			datacolors = [];
					[cost500,cost600,cost700,cost800,cost900,cost1000,cost1100,cost1200,cost1300,cost1400,cost1500,cost1600,cost1700,cost1800,cost1900,cost2000,cost2100,cost2200,cost2300,cost2400,cost2500,cost2500plus,costless].forEach((count,index)=>{
					  if (count > 0) {	dataValues.push(count);		dataLabels.push(labelsArabic[index]);	datacolors.push(backgroundColor[index]);	}
					});

					barCount = dataValues.length; // ← number of visible bars
					calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					// Apply height to wrapper
					$('#costchart').parent().css('height', calculatedHeight + 'px');

					const costchart = document.getElementById('costchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(costchart, {
					  type: 'bar',
					  data: {
						labels: dataLabels,
						datasets: [{
						  label: 'العدد',
						  data: dataValues,
						  backgroundColor: datacolors,
						  borderColor: datacolors,
						  borderWidth: 1,
						  borderRadius: 6,
						  <!-- hoverBackgroundColor: '#ffffff33' -->
						}]
					  },
					  options: {
						indexAxis: 'y',                    // ← Makes it horizontal
						responsive: true,
						maintainAspectRatio: false,        // Allows full height usage
						layout: {
						  padding: { top: 0, bottom: 0, left: 0, right: 0 }  // More left space for long Arabic labels
						},
						plugins: {
						legend: {	display: false  },
						title: {
							display: true,
							text: 'حسب سعر الشراء',
							font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							color: '#1e293b', 
							padding: {  top: 5,	  bottom: 5	},
							align: 'center'
						},
						datalabels: {
							anchor: 'end',
							align: (context) => {
							  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
							  if (!isIOS) {
								return 0;
							  }
							  const value = context.dataset.data[context.dataIndex];
							  const maxValue = Math.max(...context.dataset.data);
							  if (maxValue === 0) {
								return 2; // or 0 — your choice for empty/zero chart
							  }
							  const fiftyPercentOfMax = maxValue * 0.5;
							  return value > fiftyPercentOfMax ? 15 : 2;
							},
							offset: (context) => {
							  const value = context.dataset.data[context.dataIndex];
							  const maxValue = Math.max(...context.dataset.data);
							  if (maxValue === 0) return 10;
							  const fiftyPercentOfMax = maxValue * 0.5;
							  if (value > fiftyPercentOfMax) {
								return -5;   // long bars (>50% of max) → pull label left/inside
							  } else {
								return 60;    // short or equal ≤50% → push label far right
							  }
							},	
							color: (context) => {
							  const data = context.dataset.data;
							  const value = data[context.dataIndex];
							  const max = Math.max(...data);
							  if (max === 0 || value <= max * 0.5) {
								return '#000000';
							  }
							  let bg = context.dataset.backgroundColor?.[context.dataIndex] 
									?? context.dataset.backgroundColor;
							  if (!bg?.startsWith?.('#')) return '#ffffff';
							  const hex = bg.replace(/^#/, '').length === 3
								? bg.replace(/#(.)/g, '#$1$1').slice(1)
								: bg.slice(1);
							  if (hex.length !== 6) return '#ffffff';
							  const rgb = [0,2,4].map(i => parseInt(hex.slice(i, i+2), 16));
							  const brightness = rgb[0]*0.299 + rgb[1]*0.587 + rgb[2]*0.114;
							  return brightness > 145 ? '#000000' : '#ffffff';
							},				
							font: { weight: 'bold', size: 16 },
							<!-- formatter: (value) => value, -->
							formatter: (value, ctx) => {
							  let sum = 0;
							  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  <!-- return value + '(' + percentage + '%)'; -->
							  return '(' + percentage + '%) ' + value;
							},			
						},
						tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
							}

						  }	
						},
						scales: {
						  x: {
							display: false,
							beginAtZero: true,
						  },
						  y: {
							grid: {	  display: false  },
							ticks: {
							  font: {  size: 16,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							  autoSkip: false,
							  maxRotation: 0,
							  minRotation: 0
							},
							border: {
							  display: true  // Keeps the axis line
							}
						  }
						},
					  }
					});	
		// Inclusion Chart including absent sheep
// ─── Labels (same as before) ───
					labelsArabic = ["خلال 3 أشهر","3-6 أشهر","6-9 أشهر","9-12 شهراً","12-15 شهراً","15-18 شهراً","18-21 شهراً","21-24 شهراً","24-27 شهراً","27-30 شهراً","30-33 شهراً","33-36 شهراً","36-39 شهراً","39-42 شهراً","42-45 شهراً","45-48 شهراً","48-51 شهراً","51-54 شهراً","54-57 شهراً","أكثر من 57 شهراً","غير محدد"];
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b'];

					// ─── Colors — one per group (not per bar anymore) ───
					const COLORS = {
					  <!-- yellow: '#f1c40f', -->
					  <!-- white:  '#999999' -->
						live:  ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b'],
						  absent: '#9e9e9e'   // consistent gray for all absent
					};

					// ─── Prepare three arrays for the three stacks ───
					<!-- const dataYellow  = []; -->
					<!-- const dataWhite  = []; -->
					<!-- const dataLabels  = []; -->
					const dataLive  = [];
					const dataAbsent = [];
					dataLabels = [];
					// Order must match labelsArabic
					<!-- const ageGroups = [ -->
					  <!-- { y: sheep1yellow,   g: sheep1green,   b: sheep1blue,   w: sheep1white   }, -->
					  <!-- { y: sheep2yellow,   g: sheep2green,   b: sheep2blue,   w: sheep2white   }, -->
					  <!-- { y: sheep3yellow,   g: sheep3green,   b: sheep3blue,   w: sheep3white   }, -->
					  <!-- { y: sheep4yellow,   g: sheep4green,   b: sheep4blue,   w: sheep4white   }, -->
					  <!-- { y: sheep5yellow,   g: sheep5green,   b: sheep5blue,   w: sheep5white   }, -->
					  <!-- { y: sheep6yellow,   g: sheep6green,   b: sheep6blue,   w: sheep6white   }, -->
					  <!-- { y: sheep7yellow,   g: sheep7green,   b: sheep7blue,   w: sheep7white   }, -->
					  <!-- { y: sheep8yellow,   g: sheep8green,   b: sheep8blue,   w: sheep8white   }, -->
					  <!-- { y: sheep9yellow,   g: sheep9green,   b: sheep9blue,   w: sheep9white   }, -->
					  <!-- { y: sheep10yellow,  g: sheep10green,  b: sheep10blue,  w: sheep10white  }, -->
					  <!-- { y: sheep11yellow,  g: sheep11green,  b: sheep11blue,  w: sheep11white  }, -->
					  <!-- { y: sheep12yellow,  g: sheep12green,  b: sheep12blue,  w: sheep12white  }, -->
					  <!-- { y: sheep24yellow,  g: sheep24green,  b: sheep24blue,  w: sheep24white  }, -->
					  <!-- { y: sheep36yellow,  g: sheep36green,  b: sheep36blue,  w: sheep36white  }, -->
					  <!-- { y: sheep48yellow,  g: sheep48green,  b: sheep48blue,  w: sheep48white  }, -->
					  <!-- { y: sheep60yellow,  g: sheep60green,  b: sheep60blue,  w: sheep60white  }, -->
					  <!-- { y: sheepaglessyellow, g: sheepaglessgreen, b: sheepaglessblue, w: sheepaglesswhite } -->
					<!-- ]; -->
					// Order must match labelsArabic
const inclusionGroups = [
  { live: incdate3,       absent: incdate3absent     },
  { live: incdate6,       absent: incdate6absent     },
  { live: incdate9,       absent: incdate9absent     },
  { live: incdate12,      absent: incdate12absent    },
  { live: incdate15,      absent: incdate15absent    },
  { live: incdate18,      absent: incdate18absent    },
  { live: incdate21,      absent: incdate21absent    },
  { live: incdate24,      absent: incdate24absent    },
  { live: incdate27,      absent: incdate27absent    },
  { live: incdate30,      absent: incdate30absent    },
  { live: incdate33,      absent: incdate33absent    },
  { live: incdate36,      absent: incdate36absent    },
  { live: incdate39,      absent: incdate39absent    },
  { live: incdate42,      absent: incdate42absent    },
  { live: incdate45,      absent: incdate45absent    },
  { live: incdate48,      absent: incdate48absent    },
  { live: incdate51,      absent: incdate51absent    },
  { live: incdate54,      absent: incdate54absent    },
  { live: incdate57,      absent: incdate57absent    },
  { live: incdate60,      absent: incdate60absent    },
  { live: incdateless,    absent: incdatelessabsent  }
];

inclusionGroups.forEach((group, i) => {
  // Always push — even if zero
  dataLive.push(group.live   || 0);
  dataAbsent.push(group.absent || 0);
  dataLabels.push(labelsArabic[i]);
});


					// skip zero values 
					<!-- ageGroups.forEach((group, i) => { -->
					  <!-- const total = group.y + group.g + group.b; -->
					  <!-- if (total > 0) { -->
						<!-- dataYellow.push(group.y); -->
						<!-- dataGreen.push(group.g); -->
						<!-- dataBlue.push(group.b); -->
						<!-- dataLabels.push(labelsArabic[i]); -->
					  <!-- } -->
					<!-- }); -->
					

					// ─── Only keep groups that have at least one sheep ───
					barCount = dataLabels.length;

					// ─── Dynamic height (tune MIN_HEIGHT_PER_BAR if needed) ───
					MIN_HEIGHT_PER_BAR = 40;   // ← 38–55 usually good for Arabic
					EXTRA_SPACE = 50;          // title + legend + padding
					calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					$('#inclusionchart').parent().css('height', calculatedHeight + 'px');

					// ─── Chart ───
					const ctx = document.getElementById('inclusionchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(ctx, {
					  type: 'bar',
					  data: {
						labels: dataLabels,
						datasets: [
							{
								label: 'حي',
								data: dataLive,
								backgroundColor: COLORS.live,          // different color per bar
								borderColor: COLORS.live,
								borderWidth: 1,
								borderRadius: 4,
								stack: 'inclusion',
						  },
						  {
								label: 'مصرف',
								data: dataAbsent,
								backgroundColor: COLORS.absent,        // same gray everywhere
								borderColor: COLORS.absent,
								borderWidth: 1,
								borderRadius: 4,
								stack: 'inclusion',
							  }
						]
					  },
					  options: {
						indexAxis: 'y',               // horizontal bars
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
						  legend: {
							display: true,
							position: 'top',
							labels: {
							  font: { size: 16, weight: 'bold' },
							  boxWidth: 20,
							  padding: 16
							}
						  },
						  title: {
							display: true,
							text: 'حسب تاريخ الضم للمراح',
							font: { size: 20, weight: 'bold' },
							color: '#1e293b',
							padding: { top: 8, bottom: 12 }
						  },
						  tooltip: {
							displayColors: true,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							footerFont: { size: 20, family: 'Tajawal, sans-serif' },
							mode: 'index',
							intersect: false,
							axis: 'y',               // ← add this
							position: 'nearest',     // ← helps a lot with horizontal bars
							callbacks: {
								label: (ctx) => {
									return `${ctx.dataset.label}: ${ctx.raw} رأس`;
								},
								footer: (tooltipItems) => {
									if (tooltipItems.length === 0) return '';
									const sum = tooltipItems.reduce((total, item) => {
										return total + (item.raw || 0);
									}, 0);
									return `المجموع: ${sum} رأس`;
								},
								footerFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								footerColor: '#2ecc71',   // example: green
								<!-- footerMarginTop: 8, -->
								<!-- footerSpacing: 4 -->
							}
						  },
						  datalabels: {
							display: (context) => context.dataset.data[context.dataIndex] > 0,
							<!-- color: '#000', -->
							color: getContrastColor,
							font: { weight: 'bold', size: 16 },
							<!-- formatter: (value) => value > 4 ? value : '',   // hide very small numbers -->
							formatter: (value) => value,   // hide very small numbers
							offset: 1,
							anchor: 'center',
							align: (context) => {	// Fix vertical allignement in IOS
								const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
								return isIOS ? 10 : 2;   // ← 10 degrees on iOS, 0 on others
							},
						  },
						  
						},
						scales: {
						  x: {
							stacked: true,
							beginAtZero: true,
							display: true,
							title: {
							  display: true,
							  text: 'عدد الرؤوس',
							  font: { size: 15 }
							}
						  },
						  y: {
							stacked: true,
							grid: { display: false },
							ticks: {
							  font: { size: 15, weight: '500' },
							  autoSkip: false,
							  maxRotation: 0,
							  minRotation: 0
							}
						  }
						}
					  }
					});		
		// Inclusion Chart		
					<!-- labelsArabic = ["خلال 3 أشهر","3-6 أشهر","6-9 أشهر","9-12 شهراً","12-15 شهراً","15-18 شهراً","18-21 شهراً","21-24 شهراً","24-27 شهراً","27-30 شهراً","30-33 شهراً","33-36 شهراً","36-39 شهراً","39-42 شهراً","42-45 شهراً","45-48 شهراً","48-51 شهراً","51-54 شهراً","54-57 شهراً","أكثر من 57 شهراً","غير محدد"]; -->
					<!-- backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b']; -->

					<!-- dataValues = [];			dataLabels = [];			datacolors = []; -->
					<!-- [incdate3,incdate6,incdate9,incdate12,incdate15,incdate18,incdate21,incdate24,incdate27,incdate30,incdate33,incdate36,incdate39,incdate42,incdate45,incdate48,incdate51,incdate54,incdate57,incdate60,incdateless].forEach((count,index)=>{ -->
					  <!-- if (count > 0) {	dataValues.push(count);		dataLabels.push(labelsArabic[index]);	datacolors.push(backgroundColor[index]);	} -->
					<!-- }); -->

					<!-- barCount = dataValues.length; // ← number of visible bars -->
					<!-- calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE; -->

					<!-- // Apply height to wrapper -->
					<!-- $('#inclusionchart').parent().css('height', calculatedHeight + 'px'); -->

					<!-- const inclusionchart = document.getElementById('inclusionchart').getContext('2d'); -->
					<!-- Chart.defaults.font.family = 'Tajawal, sans-serif'; -->
					<!-- Chart.register(ChartDataLabels); -->

					<!-- new Chart(inclusionchart, { -->
					  <!-- type: 'bar', -->
					  <!-- data: { -->
						<!-- labels: dataLabels, -->
						<!-- datasets: [{ -->
						  <!-- label: 'العدد', -->
						  <!-- data: dataValues, -->
						  <!-- backgroundColor: datacolors, -->
						  <!-- borderColor: datacolors, -->
						  <!-- borderWidth: 1, -->
						  <!-- borderRadius: 6, -->
						<!-- }] -->
					  <!-- }, -->
					  <!-- options: { -->
						<!-- indexAxis: 'y',                    // ← Makes it horizontal -->
						<!-- responsive: true, -->
						<!-- maintainAspectRatio: false,        // Allows full height usage -->
						<!-- layout: { -->
						  <!-- padding: { top: 0, bottom: 0, left: 0, right: 0 }  // More left space for long Arabic labels -->
						<!-- }, -->
						<!-- plugins: { -->
						<!-- legend: {	display: false  }, -->
						<!-- title: { -->
							<!-- display: true, -->
							<!-- text: 'حسب تاريخ الضم', -->
							<!-- font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	}, -->
							<!-- color: '#1e293b',  -->
							<!-- padding: {  top: 5,	  bottom: 5	}, -->
							<!-- align: 'center' -->
						<!-- }, -->
						<!-- datalabels: { -->
							<!-- anchor: 'end', -->
							<!-- align: (context) => { -->
							  <!-- const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream; -->
							  <!-- if (!isIOS) { -->
								<!-- return 0; -->
							  <!-- } -->
							  <!-- const value = context.dataset.data[context.dataIndex]; -->
							  <!-- const maxValue = Math.max(...context.dataset.data); -->
							  <!-- if (maxValue === 0) { -->
								<!-- return 2; // or 0 — your choice for empty/zero chart -->
							  <!-- } -->
							  <!-- const fiftyPercentOfMax = maxValue * 0.5; -->
							  <!-- return value > fiftyPercentOfMax ? 15 : 2; -->
							<!-- }, -->
							<!-- // Dynamic horizontal offset based on bar length -->
							<!-- offset: (context) => { -->
							  <!-- const value = context.dataset.data[context.dataIndex]; -->
							  <!-- const maxValue = Math.max(...context.dataset.data); -->
							  <!-- if (maxValue === 0) return 10; -->
							  <!-- const fiftyPercentOfMax = maxValue * 0.5; -->
							  <!-- if (value > fiftyPercentOfMax) { -->
								<!-- return -5;   // long bars (>50% of max) → pull label left/inside -->
							  <!-- } else { -->
								<!-- return 60;    // short or equal ≤50% → push label far right -->
							  <!-- } -->
							<!-- },									 -->
							<!-- color: function(context) { -->
							  <!-- const value = context.dataset.data[context.dataIndex]; -->
							  <!-- const maxValue = Math.max(...context.dataset.data); -->

							  <!-- if (maxValue === 0) return '#333333'; -->

							  <!-- const fiftyPercentOfMax = maxValue * 0.5; -->
							  <!-- const preferred = value > fiftyPercentOfMax ? '#ffffff' : '#333333'; -->

							  <!-- // Now check background contrast and override only if it would be unreadable -->
							  <!-- let bgColor = context.dataset.backgroundColor; -->
							  <!-- if (Array.isArray(bgColor)) bgColor = bgColor[context.dataIndex]; -->

							  <!-- if (!bgColor || typeof bgColor !== 'string' || !bgColor.startsWith('#')) { -->
								<!-- return preferred; // no valid bg → keep original choice -->
							  <!-- } -->

							  <!-- const hex = bgColor.replace(/^#/, ''); -->
							  <!-- const full = hex.length === 3 ? hex.replace(/./g, '$&$&') : hex; -->

							  <!-- if (full.length !== 6) return preferred; -->

							  <!-- const r = parseInt(full.slice(0,2), 16); -->
							  <!-- const g = parseInt(full.slice(2,4), 16); -->
							  <!-- const b = parseInt(full.slice(4,6), 16); -->

							  <!-- const brightness = r * 0.299 + g * 0.587 + b * 0.114; -->

							  <!-- // Force white text on very dark backgrounds, black on very light ones -->
							  <!-- if (brightness < 70)  return '#ffffff';   // very dark bg → must be white -->
							  <!-- if (brightness > 210) return '#000000';   // very light bg → must be black -->

							  <!-- // Otherwise keep the value-based preference -->
							  <!-- return preferred; -->
							<!-- },					 -->
							<!-- font: { weight: 'bold', size: 16 }, -->
							<!-- formatter: (value, ctx) => { -->
							  <!-- let sum = 0; -->
							  <!-- ctx.chart.data.datasets[0].data.forEach(d => sum += d); -->
							  <!-- const percentage = Math.round((value / sum) * 100); -->
							  <!-- return '(' + percentage + '%) ' + value; -->
							<!-- }, -->
						<!-- }, -->
						<!-- tooltip: { -->
							<!-- displayColors: false, -->
							<!-- xAlign: 'center', -->
							<!-- yAlign: 'bottom', -->
							<!-- titleAlign: 'center', -->
							<!-- bodyAlign: 'center', -->
							<!-- cornerRadius: 8, -->
							<!-- padding: 10, -->
							<!-- titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' }, -->
							<!-- bodyFont: { size: 20, family: 'Tajawal, sans-serif' }, -->
							<!-- // remove / change the little arrow/caret -->
							<!-- caretPadding: 10, -->
							<!-- caretSize: 6, -->
							<!-- callbacks: { -->
								<!-- label: (context) => { -->
								  <!-- let sum = context.dataset.data.reduce((a,b)=>a+b,0); -->
								  <!-- let perc = Math.round((context.raw / sum) * 100); -->
								  <!-- return `${context.raw} (${perc}%)`; -->
								<!-- } -->
							<!-- } -->

						  <!-- }	 -->
						<!-- }, -->
						<!-- scales: { -->
						  <!-- x: { -->
							<!-- display: false, -->
							<!-- beginAtZero: true, -->
						  <!-- }, -->
						  <!-- y: { -->
							<!-- grid: {	  display: false  }, -->
							<!-- ticks: { -->
							  <!-- font: {  size: 16,  weight: 'bold',	  family: 'Tajawal, sans-serif'	}, -->
							  <!-- autoSkip: false, -->
							  <!-- maxRotation: 0, -->
							  <!-- minRotation: 0 -->
							<!-- }, -->
							<!-- border: { -->
							  <!-- display: true  // Keeps the axis line -->
							<!-- } -->
						  <!-- } -->
						<!-- }, -->
					  <!-- } -->
					<!-- });	 -->

		// Status Chart
					if ( userid == 1 || userid > 1000 ) {	console.log('user is 1');
						// ─── Labels (same as before) ───
						const labelsArabic = [
						  'نافقه', 'مباعه', 'مهداه', 'مذبوحه'
						];

						// ─── Colors — one per group (not per bar anymore) ───
						const COLORS = {
						  yellow: '#f1c40f',
						  white:  '#999',
						  green:  '#2ecc71',
						  blue:   '#3498db'
						};

						// ─── Prepare three arrays for the three stacks ───
						const dataYellow  = [];
						const dataWhite   = [];
						const dataGreen   = [];
						const dataBlue    = [];
						const dataLabels  = [];

						// Order must match labelsArabic
						const ageGroups = [
							{ y: deadYellow,   g: deadGreen,   b: deadBlue,   w: deadWhite   },
							{ y: soldYellow,   g: soldGreen,   b: soldBlue,   w: soldWhite   },
							{ y: giftedYellow, g: giftedGreen, b: giftedBlue, w: giftedWhite },
							{ y: killedYellow, g: killedGreen, b: killedBlue, w: killedWhite }
						];

						ageGroups.forEach((group, i) => {
						  const total = group.y + group.g + group.b + group.w;
						  if (total > 0) {
							dataYellow.push(group.y);
							dataWhite.push(group.w);
							dataGreen.push(group.g);
							dataBlue.push(group.b);
							dataLabels.push(labelsArabic[i]);
						  }
						});

						// ─── Only keep groups that have at least one sheep ───
						const barCount = dataLabels.length;

						// ─── Dynamic height (tune MIN_HEIGHT_PER_BAR if needed) ───
						const MIN_HEIGHT_PER_BAR = 100;   // ← 38–55 usually good for Arabic
						const EXTRA_SPACE = 50;          // title + legend + padding
						const calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

						$('#statuschart').parent().css('height', calculatedHeight + 'px');

						// ─── Chart ───
						const statuschart = document.getElementById('statuschart').getContext('2d');
						Chart.defaults.font.family = 'Tajawal, sans-serif';
						Chart.register(ChartDataLabels);

						new Chart(statuschart, {
						  type: 'bar',
						  data: {
							labels: dataLabels,
							datasets: [
							  {
								label: 'أصفر',
								data: dataYellow,
								backgroundColor: COLORS.yellow,
								borderColor: COLORS.yellow,
								borderWidth: 1,
								borderRadius: 4,
								stack: 'Stack 0',   // all three share same stack
							  },
							  {
								label: 'أبيض',
								data: dataWhite,
								backgroundColor: COLORS.white,
								borderColor: COLORS.white,
								borderWidth: 1,
								borderRadius: 4,
								stack: 'Stack 0',   // all three share same stack
							  },
							  {
								label: 'أزرق',
								data: dataBlue,
								backgroundColor: COLORS.blue,
								borderColor: COLORS.blue,
								borderWidth: 1,
								borderRadius: 4,
								stack: 'Stack 0',
							  },
							  {
								label: 'أخضر',
								data: dataGreen,
								backgroundColor: COLORS.green,
								borderColor: COLORS.green,
								borderWidth: 1,
								borderRadius: 4,
								stack: 'Stack 0',
							  }
							]
						  },
						  options: {
							indexAxis: 'y',               // horizontal bars
							responsive: true,
							maintainAspectRatio: false,
							plugins: {
							  legend: {
								display: true,
								position: 'top',
								labels: {
								  font: { size: 16, weight: 'bold' },
								  boxWidth: 20,
								  padding: 16
								}
							  },
							  title: {
								display: true,
								text: 'حسب التصريف',
								font: { size: 20, weight: 'bold' },
								color: '#1e293b',
								padding: { top: 8, bottom: 12 }
							  },
							  tooltip: {
								displayColors: true,
								xAlign: 'center',
								yAlign: 'bottom',
								titleAlign: 'center',
								bodyAlign: 'center',
								cornerRadius: 8,
								padding: 10,
								titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
								mode: 'index',
								intersect: false,
								axis: 'y',               // ← add this
								position: 'nearest',     // ← helps a lot with horizontal bars
								callbacks: {
									label: (ctx) => {
										return `${ctx.dataset.label}: ${ctx.raw} رأس`;
									},
									footer: (tooltipItems) => {
										if (tooltipItems.length === 0) return '';
										const sum = tooltipItems.reduce((total, item) => {
											return total + (item.raw || 0);
										}, 0);
										return `المجموع: ${sum} رأس`;
									},
									footerFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
									footerColor: '#2ecc71',   // example: green
									<!-- footerMarginTop: 8, -->
									<!-- footerSpacing: 4 -->
								}
							  },
							  datalabels: {
								display: (context) => context.dataset.data[context.dataIndex] > 0,
								<!-- color: '#000', -->
								font: { weight: 'bold', size: 16 },
								<!-- formatter: (value) => value > 4 ? value : '',   // hide very small numbers -->
								formatter: (value) => value,   // hide very small numbers
								offset: 1,
								anchor: 'center',
								<!-- align: 0, -->
								align: (context) => { // Fix vertical allignement in IOS
								const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
								<!-- return isIOS ? 15 : 0; // ← 10 degrees on iOS, 0 on others -->
								return isIOS ? 10 : 0; // ← 10 degrees on iOS, 0 on others
								},
								offset:0,
								color: getContrastColor,
								<!-- offset: (context) => { -->
								  <!-- const value = context.dataset.data[context.dataIndex]; -->
								  <!-- const maxValue = Math.max(...context.dataset.data); -->
								  <!-- if (maxValue === 0) return 10; -->
								  <!-- const fiftyPercentOfMax = maxValue * 0.5; -->
								  <!-- if (value > fiftyPercentOfMax) { -->
									<!-- return -5;   // long bars (>50% of max) → pull label left/inside -->
								  <!-- } else { -->
									<!-- return 60;    // short or equal ≤50% → push label far right -->
								  <!-- } -->
								<!-- },	 -->
							  }
							},
							scales: {
							  x: {
								stacked: true,
								beginAtZero: true,
								display: true,
								title: {
								  display: true,
								  text: 'عدد الرؤوس',
								  font: { size: 15 }
								}
							  },
							  y: {
								stacked: true,
								grid: { display: false },
								ticks: {
								  font: { size: 15, weight: '500' },
								  autoSkip: false,
								  maxRotation: 0,
								  minRotation: 0
								}
							  }
							}
						  }
						});
					} else {
						labelsArabic = ["مذبوحه","مباعه","مهداه","نافقه"];
						backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f'];

						dataValues = [];			dataLabels = [];			datacolors = [];			
						[killed,sold,gifted,dead].forEach((count,index)=>{
						  if (count > 0) {	dataValues.push(count);		dataLabels.push(labelsArabic[index]);	datacolors.push(backgroundColor[index]);	}
						});

						barCount = dataValues.length; // ← number of visible bars
						calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR * 1.4) + EXTRA_SPACE;

						// Apply height to wrapper
						$('#statuschart').parent().css('height', calculatedHeight + 'px');

						const statuschart = document.getElementById('statuschart').getContext('2d');
						Chart.defaults.font.family = 'Tajawal, sans-serif';
						Chart.register(ChartDataLabels);

						new Chart(statuschart, {
						  type: 'bar',
						  data: {
							labels: dataLabels,
							datasets: [{
							  label: 'العدد',
							  data: dataValues,
							  backgroundColor: datacolors,
							  borderColor: datacolors,
							  borderWidth: 1,
							  borderRadius: 6,
							  <!-- hoverBackgroundColor: '#ffffff33' -->
							}]
						  },
						  options: {
							indexAxis: 'y',                    // ← Makes it horizontal
							responsive: true,
							maintainAspectRatio: false,        // Allows full height usage
							layout: {
							  padding: { top: 0, bottom: 0, left: 0, right: 0 }  // More left space for long Arabic labels
							},
							plugins: {
							legend: {	display: false  },
							title: {
								display: true,
								text: 'حسب الإقصاء',
								font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
								color: '#1e293b', 
								padding: {  top: 5,	  bottom: 5	},
								align: 'center'
							},
							datalabels: {
								anchor: 'end',
								align: (context) => {
								  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream;
								  if (!isIOS) {
									return 0;
								  }
								  const value = context.dataset.data[context.dataIndex];
								  const maxValue = Math.max(...context.dataset.data);
								  if (maxValue === 0) {
									return 2; // or 0 — your choice for empty/zero chart
								  }
								  const fiftyPercentOfMax = maxValue * 0.5;
								  return value > fiftyPercentOfMax ? 15 : 2;
								},
								offset: (context) => {
								  const value = context.dataset.data[context.dataIndex];
								  const maxValue = Math.max(...context.dataset.data);
								  if (maxValue === 0) return 10;
								  const fiftyPercentOfMax = maxValue * 0.5;
								  if (value > fiftyPercentOfMax) {
									return -5;   // long bars (>50% of max) → pull label left/inside
								  } else {
									return 60;    // short or equal ≤50% → push label far right
								  }
								},	
								color: (context) => {
								  const data = context.dataset.data;
								  const value = data[context.dataIndex];
								  const max = Math.max(...data);

								  if (max === 0 || value <= max * 0.5) {
									return '#000000';
								  }

								  // Only high values → contrast from background
								  let bg = context.dataset.backgroundColor?.[context.dataIndex] 
										?? context.dataset.backgroundColor;

								  if (!bg?.startsWith?.('#')) return '#ffffff';

								  const hex = bg.replace(/^#/, '').length === 3
									? bg.replace(/#(.)/g, '#$1$1').slice(1)
									: bg.slice(1);

								  if (hex.length !== 6) return '#ffffff';

								  const rgb = [0,2,4].map(i => parseInt(hex.slice(i, i+2), 16));
								  const brightness = rgb[0]*0.299 + rgb[1]*0.587 + rgb[2]*0.114;

								  return brightness > 145 ? '#000000' : '#ffffff';
								},					
								font: { weight: 'bold', size: 16 },
								<!-- formatter: (value) => value, -->
								formatter: (value, ctx) => {
								  let sum = 0;
								  ctx.chart.data.datasets[0].data.forEach(d => sum += d);
								  const percentage = Math.round((value / sum) * 100);
								  <!-- return value + '(' + percentage + '%)'; -->
								  return '(' + percentage + '%) ' + value;
								},			
							},
							tooltip: {
								displayColors: false,
								xAlign: 'center',
								yAlign: 'bottom',
								titleAlign: 'center',
								bodyAlign: 'center',
								cornerRadius: 8,
								padding: 10,
								titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
								bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
								// remove / change the little arrow/caret
								caretPadding: 10,
								caretSize: 6,
								callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return `${context.raw} (${perc}%)`;
								}
								}
							  }	
							},
							scales: {
							  x: {
								display: false,
								beginAtZero: true,
							  },
							  y: {
								grid: {	  display: false  },
								ticks: {
								  font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
								  autoSkip: false,
								  maxRotation: 0,
								  minRotation: 0
								},
								border: {
								  display: true  // Keeps the axis line
								}
							  }
							},
						  }
						});	
					}
				}
				
		// Feed Starts here
				var feednum = response.feednum;
				var suppliernum = response.suppliernum;
				var purchasenum = response.purchasenum;
				var feedcostperday = 0;
				if ( feednum > 0 ) {
					var feedtypearr = [];		var feedqtyarr = [];		var feedunitarr = [];	var feedtimetofinisharr = [];	var feedcostarr = [];	var feedcosttotal = 0;	
					for (var i = 0; i < response[j].length; i++) {
						feedtypearr.push(response[j][i].name);
						feedqtyarr.push(response[j][i].quantity);
						feedunitarr.push(response[j][i].unitar);
						feedcostarr.push(Number(response[j][i].unitcost*response[j][i].quantity).toFixed(0));
						feedcosttotal += Number(response[j][i].unitcost*response[j][i].quantity);
						
						if ( response[j][i].dailyintake !== '' && response[j][i].dailyintake !== null && response[j][i].dailyintake !== undefined && response[j][i].dailyintake !== '0' ) {	
							feedtimetofinisharr.push(	parseInt(response[j][i].quantity / response[j][i].dailyintake)	);
							feedcostperday +=  response[j][i].dailyintake * response[j][i].unitcost;
						} else {
							feedtimetofinisharr.push('غير مستهلك');
						}
					}
					<!-- console.log(feedtimetofinisharr); -->
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-green text-center text-1 p-1">مخزون الأعلاف</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					for (var i = 0; i < feedtypearr.length; i++) {
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2  text-c-green text-1 p-0 ma">'+feedqtyarr[i]+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-1 p-0 ma">'+feedunitarr[i]+'</span>';
						newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-blue text-1 text-left mb-0 p-0 ">'+feedtypearr[i]+'</span>';
						<!-- newcard +=         '<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-c-magenta-pink text-14 text-right p-0 ma" style="margin-top:-9px;margin-bottom: -5px;" data-toggle="tooltip" data-placement="top" title="" data-original-title="تحسب بناء على كمية العلف و الاستهلاك اليومي">تكفي لـ '+feedtimetofinisharr[i]+' يوماً</span>'; -->
									if (typeof feedtimetofinisharr[i] !== 'number') {
										newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-c-magenta-pink text-13 text-right p-0 ma" style="" data-toggle="tooltip" data-placement="top" title="" data-original-title="تحسب بناء على كمية العلف و الاستهلاك اليومي">'+feedtimetofinisharr[i]+'</span>';
									} else {
										newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-c-magenta-pink text-13 text-right p-0 ma" style="" data-toggle="tooltip" data-placement="top" title="" data-original-title="تحسب بناء على كمية العلف و الاستهلاك اليومي">حتى  '+feedtimetofinisharr[i]+' يوماً</span>';
									}

						<!-- newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-c-magenta-pink text-13 text-right p-0 ma" style="" data-toggle="tooltip" data-placement="top" title="" data-original-title="تحسب بناء على كمية العلف و الاستهلاك اليومي">حتى  '+feedtimetofinisharr[i]+' يوماً</span>'; -->

						if ( i != feedtypearr.length-1 ) {
							newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						}
					}

					newcard +=     '</div>';
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';

					if (feedtypearr.length > 0) {	// if atleast two are < zero
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="feedchart"></canvas>';
					newcard +=         '</div>';


					
					newcard +=     '</div>';
					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';

					
					<!-- newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>'; -->
					$('.card-columns').append(newcard);
					j++;
					
		// feed Chart
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];
					const feedchart = document.getElementById('feedchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(feedchart, {
					  type: 'doughnut',  
					  data: {
						labels: feedtypearr,
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: feedqtyarr,
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						<!-- maintainAspectRatio: true, -->
						responsive: true,
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\n'+feedunitarr[ctx.dataIndex];
							  
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
									if (typeof feedtimetofinisharr[context.dataIndex] !== 'number') {
									  return [
										'القيمه السوقيه '+feedcostarr[context.dataIndex]+' ريال',
										feedtimetofinisharr[context.dataIndex]
									  ];
									} else {
									  return [
										'القيمه السوقيه '+feedcostarr[context.dataIndex]+' ريال',
										'ينفذ خلال '+feedtimetofinisharr[context.dataIndex]+' يوما'
									  ];
									}
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'القيمه السوقيه',
								  feedcosttotal.toFixed(0),   // total value
								  'ريال',                             // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						  
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});
				}

		// Water starts here		
				var waternum = response.waternum;
				var suppliernum = response.suppliernum;
				var purchasenum = response.purchasenum;
				var watercostperday = 0;

				if ( waternum > 0 ) {
					var watertypearr = [];		var waterqtyarr = [];		var waterunitarr = [];	var watertimetofinisharr = [];		var watercostarr = [];	var watercosttotal = 0;	
					for (var i = 0; i < response[j].length; i++) {
						watertypearr.push(response[j][i].name);
						waterqtyarr.push(Number(response[j][i].quantity));
						waterunitarr.push(response[j][i].unitar);
						watercostarr.push(Number(response[j][i].unitcost*response[j][i].quantity).toFixed(0));
						watercosttotal += Number(response[j][i].unitcost*response[j][i].quantity);

						var costperday = 0;
						if ( response[j][i].dailyintake !== '' && response[j][i].dailyintake !== null && response[j][i].dailyintake !== undefined && response[j][i].dailyintake !== '0' ) {	
							watertimetofinisharr.push(	parseInt(response[j][i].quantity / response[j][i].dailyintake)	);
							watercostperday +=  response[j][i].dailyintake * response[j][i].unitcost;
						} else {
							watertimetofinisharr.push(	'???'	);
						}
					}
					

					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-blue text-center text-1 p-1">مخزون المياه</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					for (var i = 0; i < watertypearr.length; i++) {
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2  text-c-green text-1 p-0 ma">'+waterqtyarr[i]+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-1 p-0 ma">'+waterunitarr[i]+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2  text-c-blue text-1 text-left mb-0 p-0 ">'+watertypearr[i]+'</span>';
						newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-c-magenta-pink text-13 text-right p-0 ma" style="" data-toggle="tooltip" data-placement="top" title="" data-original-title="تحسب بناء على كمية المياه و الاستهلاك اليومي">حتى  '+watertimetofinisharr[i]+' يوماً</span>';

						if ( i != watertypearr.length-1 ) {
							newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						}
					}

					newcard +=     '</div>';
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					if (watertypearr.length > 0) {	// if atleast two are < zero
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="waterchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';

					
					<!-- newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>'; -->
					$('.card-columns').append(newcard);
					j++;
					
		// Water Chart
					const waterchart = document.getElementById('waterchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(waterchart, {
					  type: 'doughnut',  
					  data: {
						labels: watertypearr,
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: waterqtyarr,
						  backgroundColor: ['#2986cc','#c90076','#16496f' ],
						  borderColor: ['#2986cc','#c90076','#16496f' ],
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\n'+waterunitarr[ctx.dataIndex];
							  
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
									if (typeof watertimetofinisharr[context.dataIndex] !== 'number') {
									  return [
										'القيمه السوقيه '+watercostarr[context.dataIndex],
										<!-- watertimetofinisharr[context.dataIndex], -->
									  ];
									} else {
									  return [
										'القيمه السوقيه '+watercostarr[context.dataIndex],
										'ينفذ خلال '+watertimetofinisharr[context.dataIndex]+' يوما'
									  ];
									}
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'القيمه السوقيه',
								  watercosttotal.toFixed(0),   // total value
								  'ريال',                             // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }						  
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});			
				}
				
		// opex starts here		
				var opexnum = response.opexnum;
				var opexcostperday = 0;
				var opexcostpermonth = 0;
				var daysInMonth = 30.42;
				var opexdescriptionarr = [];		var opexcyclearr = [];		var opexcostarr = [];		// Charting Array
				if ( opexnum > 0 ) {			
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-gold text-center text-1 p-1">التكاليف التشغيلية القائمة</span></div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					for (var i = 0; i < response[j].length; i++) { 
						daysInMonth = response[j][i].daysInMonth;
						response[j][i].cost = Number(response[j][i].cost);
						if ( response[j][i].cycle == 'monthly' ) {
							opexcostperday += response[j][i].cost / response[j][i].daysInMonth;
							opexcostpermonth += response[j][i].cost;
							opexcostarr.push(response[j][i].cost);
						}
						if ( response[j][i].cycle == 'yearly' ) {
							opexcostperday += response[j][i].cost / response[j][i].daysInYear;
							opexcostpermonth += response[j][i].cost / 12;
							opexcostarr.push((response[j][i].cost/12).toFixed(0));
						}
						opexdescriptionarr.push(response[j][i].description);				opexcyclearr.push(response[j][i].cyclear);

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">'+response[j][i].description+' ('+response[j][i].cyclear+')</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+response[j][i].cost+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					newcard +=     '</div>';
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					if (response[j].length > 0) {	// if atleast two are < zero
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="opexchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';

					
					<!-- newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>'; -->
					$('.card-columns').append(newcard);
					j++;
					
		// Opex Chart
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					const opexchart = document.getElementById('opexchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(opexchart, {
					  type: 'doughnut',  
					  data: {
						labels: opexdescriptionarr,
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: opexcostarr,
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\nريال';
							  <!-- return value; -->
							  
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  <!-- return 'ينفذ خلال '+watertimetofinisharr[context.dataIndex]+' يوما'; -->
								  return `${context.raw} ريال \n`+opexcyclearr[context.dataIndex];
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }

						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});				
				}
				
		// capex starts here		
				var capexnum = response.capexnum;
				var capexsum = 0;
				var capexdescriptionarr = [];		var capexcostarr = [];	// Charting Array
				if ( capexnum > 0 ) {		
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-gold text-center text-1 p-1">التكاليف الرأسمالية</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					for (var i = 0; i < response[j].length; i++) { 
						capexsum += Number(response[j][i].cost);
						capexdescriptionarr.push(response[j][i].description);				capexcostarr.push(response[j][i].cost);
						
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">'+response[j][i].description+'</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma iosspan">'+response[j][i].cost+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
					newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">الاجمالي</span>';
					newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma iosspan">'+capexsum.toLocaleString('en-US')+'</span>';
					newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					if (response[j].length > 0) {	// if atleast two are < zero
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="capexchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					<!-- newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>'; -->
					$('.card-columns').append(newcard);
					j++;
					
		// Capex Chart
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b'];

					const capexchart = document.getElementById('capexchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(capexchart, {
					  type: 'doughnut',  
					  data: {
						labels: capexdescriptionarr,
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: capexcostarr,
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\nريال';
							  <!-- return value; -->
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  <!-- return 'ينفذ خلال '+watertimetofinisharr[context.dataIndex]+' يوما'; -->
								  return `${context.raw} ريال \n`;
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }				  
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});		
				}
				
		// daily operational cost
		// Monthly operational cost
				<!-- if ( opexnum > 0 ) {	 -->
				var dailypersheep = [];	var monthlypersheep = [];		// for charting
				var totalcostperday = opexcostperday + feedcostperday + watercostperday;
					totalcostperday = Number(totalcostperday.toFixed(0));

				if ( existingsheep > 0 ) { 		
					var opexcostperdaypersheep = Number((opexcostperday/existingsheep).toFixed(2));				
					dailypersheep.push(opexcostperdaypersheep);
					var feedcostperdaypersheep = Number((feedcostperday/existingsheep).toFixed(2));				
					dailypersheep.push(feedcostperdaypersheep);
					var watercostperdaypersheep = Number((watercostperday/existingsheep).toFixed(2));				
					dailypersheep.push(watercostperdaypersheep);
					var totalcostperdaypersheep = (totalcostperday/existingsheep).toFixed(2);
				}

					opexcostperday = opexcostperday.toFixed(0);
					feedcostperday = feedcostperday.toFixed(0);
					watercostperday = watercostperday.toFixed(0);
					totalcostperday = totalcostperday.toFixed(0);
				
				opexcostpermonth = Number(opexcostpermonth.toFixed(2));
				<!-- var monthlyfeedcostpermonth = feedcostperday*30.42;					monthlyfeedcostpermonth = Number(monthlyfeedcostpermonth.toFixed(0)); -->
				<!-- var monthlywatercostpermonth = watercostperday*30.42;				monthlywatercostpermonth = Number(monthlywatercostpermonth.toFixed(0)); -->
				var monthlyfeedcostpermonth = feedcostperday*daysInMonth;					monthlyfeedcostpermonth = Number(monthlyfeedcostpermonth.toFixed(0));
				var monthlywatercostpermonth = watercostperday*daysInMonth;				monthlywatercostpermonth = Number(monthlywatercostpermonth.toFixed(0));
				var totalcostpermonth = opexcostpermonth + monthlyfeedcostpermonth + monthlywatercostpermonth;
					totalcostpermonth = Number(totalcostpermonth.toFixed(0));
							
				if ( existingsheep > 0 ) {
					var opexcostpermonthpersheep = Number((opexcostpermonth/existingsheep).toFixed(2));			
						monthlypersheep.push(opexcostpermonthpersheep);
					var feedcostpermonthpersheep = Number((monthlyfeedcostpermonth/existingsheep).toFixed(2));			
						monthlypersheep.push(feedcostpermonthpersheep);
					var watercostpermonthpersheep = Number((monthlywatercostpermonth/existingsheep).toFixed(2));			
						monthlypersheep.push(watercostpermonthpersheep);
					var totalcostpermonthpersheep = (totalcostpermonth/existingsheep).toFixed(2);
				}
					
				if (opexcostperday > 0 || feedcostperday > 0 || watercostperday > 0 || opexcostpermonth > 0 || monthlyfeedcostpermonth > 0 || monthlywatercostpermonth > 0) {
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-gold text-center text-1 p-1">التكاليف التشغيلية <span class="text-left text-1 p-0 ma">(تقديريه)</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pr-1 pl-1 ">';
					<!-- newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">'; -->
					newcard +=     '<div class="row stats " style="display:none;">';

					newcard +=     '<div class="ui two item tabs menu" style="box-shadow: 0 0 0 0;" >';
					newcard +=      '<a class="item width49i active opexpill" data-tab="daily">يومي</a>';
					newcard +=      '<a class="item width49i opexpill" data-tab="monthly">شهري</a>';
					newcard +=     '</div>';
					newcard +=     '<div class="main ui maxwidth container p-0" style="display:flex;">';
					newcard +=      '<div class="ui intro tab active opextab" data-tab="daily">';

						<!-- newcard +=         '<h3 class="pb-3">اليوميه</h3>'; -->

						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-muted text-center text-1 p-0 ma" data-toggle="tooltip" data-placement="top" title="" data-original-title="مصروفات الرواتب والفواتير والايجارات ..إلخ">تكلفة التشغيل</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+opexcostperday+'<br>'+opexcostperdaypersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+opexcostperday+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-muted text-center text-1 p-0 ma">تكلفة العلف</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+feedcostperday+'<br>'+feedcostperdaypersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+feedcostperday+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';

						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-muted text-center text-1 p-0 ma">تكلفة المياه</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+watercostperday+'<br>'+watercostperdaypersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+watercostperday+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';

						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-c-black text-center text-1 p-0 ma">الاجمالي</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-blue text-center text-1 p-0 ma iosspan ">'+totalcostperday+'<br>'+totalcostperdaypersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+totalcostperday+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						
						newcard +=         '</div>';
						newcard +=         '<div class="ui intro tab opextab" data-tab="monthly">';		
						
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-muted text-center text-1 p-0 ma" data-toggle="tooltip" data-placement="top" title="" data-original-title="مصروفات الرواتب والفواتير والايجارات ..إلخ">تكلفة التشغيل</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+opexcostpermonth+'<br>'+opexcostpermonthpersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+opexcostpermonth+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';

						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-muted text-center text-1 p-0 ma">تكلفة العلف</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+monthlyfeedcostpermonth+'<br>'+feedcostpermonthpersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+monthlyfeedcostpermonth+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';

						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-muted text-center text-1 p-0 ma">تكلفة المياه</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+monthlywatercostpermonth+'<br>'+watercostpermonthpersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+monthlywatercostpermonth+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5  text-c-black text-center text-1 p-0 ma">الاجمالي</span>';
						if ( existingsheep > 0 ) {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-blue text-center text-1 p-0 ma iosspan ">'+totalcostpermonth+'<br>'+totalcostpermonthpersheep+'</span>';
						} else {
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4  text-c-green text-center text-1 p-0 ma iosspan ">'+totalcostpermonth+'<br>0.00</span>';
						}
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3 text-muted text-left text-1 p-0 ma ">ريال<br>ريال/ رأس</span>';
						
						
						newcard +=          '</div>';
						newcard +=         '</div>';
						
					newcard +=     '</div>';
					
						newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					
					newcard +=     '<div class="ui two item tabs menu" style="box-shadow: 0 0 0 0;" >';
					newcard +=      '<a class="item width49i active opexpill" data-tab="chartdaily">يومي</a>';
					newcard +=      '<a class="item width49i opexpill" data-tab="chartmonthly">شهري</a>';
					newcard +=     '</div>';

					newcard +=     '<div class="main ui maxwidth container p-0" style="display:flex;">';
					newcard +=      '<div class="ui intro tab active opextab maxwidth" data-tab="chartdaily">';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
						newcard +=          '<canvas id="chartdaily" style="margin:auto;"></canvas>';
						newcard +=         '</div>';
					newcard +=      '</div>';
					newcard +=      '<div class="ui intro tab active opextab maxwidth" data-tab="chartmonthly">';
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
						newcard +=          '<canvas id="chartmonthly" style="margin:auto;"></canvas>';
						newcard +=         '</div>';
					newcard +=      '</div>';

					newcard +=     '</div>';
					newcard +=     '</div>';
					
					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);
		// Daily Cost Chart (chartdaily)
					var dailypersheeptotal = 0;
					backgroundColor = ['#e74c3c','#208e4e','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					const chartdaily = document.getElementById('chartdaily').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(chartdaily, {
					  type: 'doughnut',  
					  data: {
						labels: ['التشغيل','العلف','المياه'],
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: [opexcostperday,feedcostperday,watercostperday],
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							  filter: (legendItem, chartData) => {			// Hide legend with zero data
								const dataset = chartData.datasets[legendItem.datasetIndex ?? 0];
								if (!dataset || !Array.isArray(dataset.data)) return false;
								const value = dataset.data[legendItem.index];
								return value != null && value !== 0;
							  }
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },
						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  if ( value == 0 ) {
								return '';
							  } else {
								return value +'\nريال';
							  }
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								const value = context.dataset.data[context.dataIndex];
									return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
							  label: (context) => {
								const total = context.dataset.data.reduce((a, b) => a + Number(b), 0);
								const value = context.raw;
								const perc = Math.round(value / total * 100);

								return [
								  `${value} ريال`,
								  ...(dailypersheep.length > 0 ? [`${dailypersheep[context.dataIndex]} ريال لكل رأس`] : []),
								  `النسبة: ${perc}%`
								];
							  }
							},
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
									// to calculate per sheep value when legend toggled off 
									dailypersheeptotal = 0,
									chart.options.plugins.legend.labels.generateLabels(chart).forEach((item, index) => {
									  if ( !item.hidden ) {	
										  if ( dailypersheep.length > 0 ) {	
											dailypersheeptotal += dailypersheep[index];	  
										  }
									  }
									}),
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال يومياً',                             // second line
								  '',
								  dailypersheeptotal.toFixed(2),
								  'ريال  للرأس يومياً',                             // second line
								],
								font: [
								  { size: 0, lineHeight: 0 },                     // second line (ريال)
								  { size: 0, lineHeight: 0 },                     // second line (ريال)
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 15, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 15, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 15, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#fff','#fff','#000', '#999', '#000', '#000', '#999', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});	
		// Monthly Cost Chart (chartmonthly)
					var monthlypersheeptotal = 0;

					backgroundColor = ['#e74c3c','#208e4e','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					const chartmonthly = document.getElementById('chartmonthly').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(chartmonthly, {
					  type: 'doughnut',  
					  data: {
						labels: ['التشغيل','العلف','المياه'],
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: [opexcostpermonth,monthlyfeedcostpermonth,monthlywatercostpermonth],
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							  filter: (legendItem, chartData) => {			// Hide legend with zero data
								const dataset = chartData.datasets[legendItem.datasetIndex ?? 0];
								if (!dataset || !Array.isArray(dataset.data)) return false;
								const value = dataset.data[legendItem.index];
								return value != null && value !== 0;
							  }
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  if ( value == 0 ) {
								return '';
							  } else {
								return value +'\nريال';
							  }
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								const value = context.dataset.data[context.dataIndex];
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
							  label: (context) => {
								const total = context.dataset.data.reduce((a, b) => a + Number(b), 0);
								const value = context.raw;
								const perc = Math.round(value / total * 100);

								return [
								  `${value} ريال`,
								  ...(monthlypersheep.length > 0 ? [`${monthlypersheep[context.dataIndex]} ريال لكل رأس`] : []),
								  `النسبة: ${perc}%`
								];
							  }
							},
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
									// to calculate per sheep value when legend toggled off 
									monthlypersheeptotal = 0,
									chart.options.plugins.legend.labels.generateLabels(chart).forEach((item, index) => {
									  if ( !item.hidden ) {	
										  if ( monthlypersheep.length > 0 ) {	
											monthlypersheeptotal += monthlypersheep[index];	  
										  }
									  }
									  <!-- if ( !item.hidden ) {	monthlypersheeptotal += monthlypersheep[index];	  } -->
									}),
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال شهريا',                             // second line
								  '',
								  monthlypersheeptotal.toFixed(2),
								  'ريال  للرأس شهريا',                             // second line
								],
								font: [
								  { size: 0, lineHeight: 0 },                     // second line (ريال)
								  { size: 0, lineHeight: 0 },                     // second line (ريال)
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 15, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 15, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 15, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#fff','#fff','#000', '#999', '#000', '#000', '#999', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});
					// to avoid building chart while hidden
					$('#chartmonthly').closest('.tab').removeClass('active');
				}			
		// opexspending starts here		
				var opexspendingnum = response.opexspendingnum;
				var opexspendingsum = 0;
				if ( opexspendingnum > 0 ) {
					for (var i = 0; i < response[j].length; i++) { 
						opexspendingsum += Number(response[j][i].cost);				//console.log(opexspendingsum);
					}
					j++;
				}

		// otherspending starts here		
				var purchasespendingnum = response.purchasespendingnum;
				
				var feedspendingsum = 0;				var waterspendingsum = 0;				var othersspendingsum = 0;
				var feeddebtsum = 0;					var waterdebtsum = 0;					var othersdebtsum = 0;
				
				if ( purchasespendingnum > 0 ) {
					for (var i = 0; i < response[j].length; i++) {			//console.log(feedspendingsum);
						if ( response[j][i].category == 'feed' ) {	
							feedspendingsum += Number(response[j][i].totalcost);	
							if ( response[j][i].totalcost !== response[j][i].paid ) { 
								feeddebtsum += Number(response[j][i].totalcost - response[j][i].paid); 
							}	
						}
						if ( response[j][i].category == 'water' ) {	
							waterspendingsum += Number(response[j][i].totalcost);	
							if ( response[j][i].totalcost !== response[j][i].paid ) { 
								waterdebtsum += Number(response[j][i].totalcost - response[j][i].paid); 
							}						
						}
						if ( response[j][i].category == 'others' ) {	
							othersspendingsum += Number(response[j][i].totalcost);	
							if ( response[j][i].totalcost !== response[j][i].paid ) { 
								othersdebtsum += Number(response[j][i].totalcost - response[j][i].paid); 
							}						
						}
						<!-- if ( response[j][i].category == 'others' ) {	othersspendingsum += Number(response[j][i].totalcost);	} -->
					}
					j++;
				}

		//debt
		// opex starts here		
				if ( feeddebtsum > 0 || waterdebtsum > 0 || othersdebtsum > 0 ) {
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-gold text-center text-1 p-1">قائمة الديون</span></div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					if ( feeddebtsum > 0 ) {			
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">الأعلاف</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+feeddebtsum+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					if ( waterdebtsum > 0 ) {			
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">المياه</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+waterdebtsum+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					if ( othersdebtsum > 0 ) {			
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">المواد الاخرى</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+othersdebtsum+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					newcard +=     '</div>';
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					if ( feeddebtsum > 0 || waterdebtsum > 0 || othersdebtsum > 0 ) {			
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
					}
					newcard +=          '<canvas id="debtchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';

					
					<!-- newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>'; -->
					$('.card-columns').append(newcard);
					
		// Debt Chart
					backgroundColor = ['#2ecc71','#3498db','#e74c3c','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#e74c3c','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					const debtchart = document.getElementById('debtchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(debtchart, {
					  type: 'doughnut',  
					  data: {
						labels: ['أعلاف','مياه','مواد اخرى'],
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: [feeddebtsum,waterdebtsum,othersdebtsum],
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							  filter: (legendItem, chartData) => {			// Hide legend with zero data
								const dataset = chartData.datasets[legendItem.datasetIndex ?? 0];
								if (!dataset || !Array.isArray(dataset.data)) return false;
								const value = dataset.data[legendItem.index];
								return value != null && value !== 0;
							  }
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\nريال';
							  <!-- return value; -->
							  
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return [
								  `${context.raw} ريال`,                          // Line 1: amount in ريال
									`النسبة: ${perc}%`,                     // Line 2: count + unit (with colon for readability)
								  ];
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال',                            		 // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }

						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});				
				}	
				
				<!-- feedspendingsum = feedspendingsum - feeddebtsum; -->
				<!-- waterspendingsum = waterspendingsum - feeddebtsum; -->
				<!-- if (opexspendingsum > 0 || feedspendingsum > 0 || waterspendingsum > 0 || othersspendingsum > 0 || capexsum > 0 || purchasedsheeptotal > 0 || previousexpense > 0) { -->
				if (opexspendingsum > 0 || feedspendingsum > 0 || waterspendingsum > 0 || othersspendingsum > 0 || capexsum > 0 || previousexpense > 0) {
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-tourchred text-center text-1 p-1">المصروفات الفعليه</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

						if ( previousexpense > 0 ) {
							newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">تكاليف سابقه</span>';
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+previousexpense+'</span>';
							newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
						}

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 " data-toggle="tooltip" data-placement="top" title="" data-original-title="مصروفات الرواتب والفواتير والايجارات ..إلخ">المصروفات التشغيليه</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+opexspendingsum.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">مصروفات العلف</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+feedspendingsum.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
						
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">مصروفات المياه</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+waterspendingsum.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-center text-1  mb-0 p-0 " data-toggle="tooltip" data-placement="top" title="" data-original-title="مصروفات المواد الأخرى مثل أملاح معادن تطعيمات ..إلخ">مصروفات اخرى</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+othersspendingsum.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
						
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">مصروفات رأسماليه</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+capexsum.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						<!-- newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">مشتريات الحلال ('+purchasedsheepcount+')</span>'; -->
						<!-- newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+purchasedsheeptotal+'</span>'; -->
						<!-- newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>'; -->

						<!-- var totalspending = opexspendingsum + feedspendingsum + waterspendingsum + othersspendingsum + capexsum + purchasedsheeptotal + previousexpense; -->
						totalspending = opexspendingsum + feedspendingsum + waterspendingsum + othersspendingsum + capexsum + previousexpense;
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">اجمالي المصروفات</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-center text-1 p-0 ma">'+totalspending.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					newcard +=         '<div class="chart-container ma maxwidth" style="">';
					newcard +=          '<canvas id="spendingchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';
					
					
					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);

		// Spending Chart
					backgroundColor = ['#e74c3c','#208e4e','#3498db','#f1c40f','#9b59b6','#208e4e','#e67e22','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					const spendingchart = document.getElementById('spendingchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(spendingchart, {
					  type: 'doughnut',  
					  data: {
						labels: ['التشغيليه','العلف','المياه','اخرى','رأسماليه','مشتريات حلال','تكاليف سابقه'],
						datasets: [{
						  <!-- label: 'العدد', -->
						  <!-- data: [ opexspendingsum,feedspendingsum,waterspendingsum,othersspendingsum,capexsum,purchasedsheeptotal,previousexpense], -->
						  data: [ opexspendingsum,feedspendingsum,waterspendingsum,othersspendingsum,capexsum,previousexpense],
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						<!-- maintainAspectRatio: true, -->
						responsive: true,
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							  filter: (legendItem, chartData) => {			// Hide legend with zero data
								const dataset = chartData.datasets[legendItem.datasetIndex ?? 0];
								if (!dataset || !Array.isArray(dataset.data)) return false;
								const value = dataset.data[legendItem.index];
								return value != null && value !== 0;
							  },
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\nريال';
							  <!-- return value; -->
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								const sum = context.dataset.data.reduce((a, b) => a + b, 0);
								return (value / sum) * 100 > 10;   // Only show if slice > 8%
								<!-- return value; -->
							},
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  return [
								  `${context.raw} ريال`,                          // Line 1: amount in ريال
									`النسبة: ${perc}%`,                     // Line 2: count + unit (with colon for readability)
								  ];
								}
							}

							<!-- callbacks: { -->
								<!-- label: (context) => { -->
								  <!-- return `${context.raw} ريال \n`; -->
								<!-- } -->
							<!-- } -->
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  'المجموع',
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال',                             // second line
								],
								font: [
								  { size: 25, lineHeight: 2 },
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#999', '#000', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});	
				}
		// Capital Loss			
				if (capitallossarr['dead'] > 0 || capitallossarr['killed'] > 0 || capitallossarr['gifted'] > 0) {

					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-tourchred text-center text-1 p-1">خسائر الحلال</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					if ( capitallossarr['dead'] > 0 ) {	
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">نافقه ('+capitallossarr['deadcount']+')</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+capitallossarr['dead']+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					if ( capitallossarr['killed'] > 0 ) {
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">مذبوحه ('+capitallossarr['killedcount']+')</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+capitallossarr['killed']+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					if ( capitallossarr['gifted'] > 0 ) {
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">مهداه ('+capitallossarr['giftedcount']+')</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+capitallossarr['gifted']+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}

					totalcapitalloss = capitallossarr['dead'] + capitallossarr['killed'] + capitallossarr['gifted'];
					if ( totalcapitalloss > 0 ) {
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">اجمالي</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+totalcapitalloss.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					} else {
						newcard +=         '<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-muted text-1 text-center mb-0 p-0 ">لا يوجد خسائر</span>';
					}

					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					if (totalcapitalloss > 0) {	// if atleast two are < zero
						newcard +=         '<div class="chart-container ma maxwidth" style="">';
						newcard +=          '<canvas id="capitallosschart"></canvas>';
						newcard +=         '</div>';

					} else {
						newcard +=         '<div class="chart-container ma maxwidth hidden">';
						newcard +=          '<canvas id="capitallosschart"></canvas>';
						newcard +=         '</div>';
						newcard +=         '<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-muted text-1 text-center mb-0 p-0 ">لا يوجد خسائر</span>';
					}
					newcard +=     '</div>';
					
					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);
		// Capital Loss Chart
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];
					var capitallosscountchartarray = [];	// for charting
					capitallosscountchartarray.push(capitallossarr['deadcount']);
					capitallosscountchartarray.push(capitallossarr['giftedcount']);
					capitallosscountchartarray.push(capitallossarr['killedcount']);
					let capitallosscountcharttotal = capitallosscountchartarray.reduce((acc, curr) => acc + curr, 0);

					const capitallosschart = document.getElementById('capitallosschart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(capitallosschart, {
					  type: 'doughnut',  
					  data: {
						labels: ['نافقه','مذبوحه','مهداه'],
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: [ capitallossarr['dead'],capitallossarr['killed'],capitallossarr['gifted']],
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							  filter: (legendItem, chartData) => {			// Hide legend with zero data
								const dataset = chartData.datasets[legendItem.datasetIndex ?? 0];
								if (!dataset || !Array.isArray(dataset.data)) return false;
								const value = dataset.data[legendItem.index];
								return value != null && value !== 0;
							  },
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\nريال';
							  <!-- return value; -->
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
									const value = context.raw;                  // e.g. 450 (the ريال amount)
									const count = capitallosscountchartarray[context.dataIndex] ?? '—';  // fallback if undefined
									return [
									`${value} ريال`,                          // Line 1: amount in ريال
									`العدد: ${count} رأس`                     // Line 2: count + unit (with colon for readability)
									];
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  <!-- 'المجموع', -->
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال',                             // second line
								  '',
								  capitallosscountcharttotal.toFixed(0),
								  'رأس',                             // second line
								],
								font: [
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 10, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 20, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#000', '#999', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});	
				}			
		// Capital gain	
				if (previousprofit > 0 || capitallossarr['sold'] > 0) {
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-green text-center text-1 p-1">مبيعات الحلال</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					if ( previousprofit > 0  ) {	
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">مبيعات سابقه</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+previousprofit+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}

					if ( capitallossarr['sold'] > 0  ) {	
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">مباعه ('+capitallossarr['soldcount']+')</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+capitallossarr['sold']+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					} 
					var totalsales = previousprofit + capitallossarr['sold'];
					if ( previousprofit > 0 && capitallossarr['sold'] > 0 ) {	
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-c-blue text-1 text-center  mb-0 p-0 ">اجمالي</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+totalsales.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';
					}
					<!-- else { -->
						<!-- newcard +=         '<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-muted text-1 text-center mb-0 p-0 ">لا يوجد مبيعات</span>'; -->

					<!-- } -->

					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					newcard +=         '<div class="chart-container ma maxwidth" style="">';
					newcard +=          '<canvas id="capitalgainchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);
		// Capital Gain Chart
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b','#795548','#9c27b0'];

					const capitalgainchart = document.getElementById('capitalgainchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);
					new Chart(capitalgainchart, {
					  type: 'doughnut',  
					  data: {
						labels: ['أرباح سابقه','مبيعات حلال'],
						datasets: [{
						  <!-- label: 'العدد', -->
						  data: [ previousprofit,capitallossarr['sold']],
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 2,
						  hoverOffset: 20  // nice pop on hover
						}]
					  },
					  options: {
						responsive: true,
						<!-- maintainAspectRatio: true, -->
						maintainAspectRatio: false,   // ← allows chart to fill container height/width independently
						aspectRatio: 0.88,             // wider layout helps when legend on right (default for doughnut is ~1)
						layout: {
							padding: { top: 10, bottom: 10, left: 0, right: 0 }
						},
						plugins: {
						  legend: {
							position: 'top',
							align: 'center',
							labels: {
							  font: { size: 16,  weight: 'bold',  family: 'Tajawal, sans-serif' },
							  padding: 10,
							  usePointStyle: true,     // makes legend items use circle/point style (nice for doughnut)
							  filter: (legendItem, chartData) => {			// Hide legend with zero data
								const dataset = chartData.datasets[legendItem.datasetIndex ?? 0];
								if (!dataset || !Array.isArray(dataset.data)) return false;
								const value = dataset.data[legendItem.index];
								return value != null && value !== 0;
							  },
							},
							rtl: true,                 // ← forces right-to-left rendering
							textDirection: 'rtl',      // optional: explicit text direction
						  },
						  title: {					display: false			  	  },

						// Simple data labels configuration
						  datalabels: {
							color: '#ffffff',
							font: { weight: 'bold', size: 16},
							textAlign: 'center',
							formatter: (value, ctx) => {
							  return value +'\nريال';
							  <!-- return value; -->
							},
							anchor: 'center',
							align: 'center',
							display: (context) => {
								// Hide labels on very small segments (< 8% for example)
								const value = context.dataset.data[context.dataIndex];
								<!-- const sum = context.dataset.data.reduce((a, b) => a + b, 0); -->
								<!-- return (value / sum) * 100 > 10;   // Only show if slice > 8% -->
								return value;
							  },
						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
									const value = context.raw;                  // e.g. 450 (the ريال amount)
									<!-- const count = capitallossarr['soldcount'] ?? '—';  // fallback if undefined -->
									return [
									`${value} ريال`,                          // Line 1: amount in ريال
									<!-- `العدد: ${count} رأس`                     // Line 2: count + unit (with colon for readability) -->
									];
								}
							}
						  },
						  annotation: {
							annotations: {
							  centerLabel: {                       // ← this is your key (can be any name, e.g. totalLabel)
								type: 'doughnutLabel',             // ← required: tells it to use doughnut center mode
								content: ({ chart }) => [
								  <!-- 'المجموع', -->
								  chart.getDatasetMeta(0).total.toFixed(0),   // total value
								  'ريال',                             // second line
								  '',                             // second line
								  <!-- 'العدد', -->
								  capitallossarr['soldcount'].toFixed(0),
								  'رأس',                             // second line
								],
								font: [
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 10, lineHeight: 1.1 },                     // second line (ريال)
								  { size: 25, weight: 'bold', lineHeight: 1.1 },    // first line (total)
								  { size: 25, lineHeight: 1.1 },                     // second line (ريال)
								],
								color: ['#000', '#999', '#999', '#000', '#999'],           // colors for each line
							  }
							}
						  }
						},
						cutout: '60%'  // controls the thickness of the ring (higher = thinner)
					  }
					});	
				}
		// New born Value
				var newborntotalmarketvalue = 0;
				var newborntotalcount = 0;
				//By Age value
				var newbornsheep1value = 0;		var newbornsheep2value = 0;		var newbornsheep3value = 0;		
				var newbornsheep4value = 0;		var newbornsheep5value = 0;		var newbornsheep12value = 0;	var newbornsheep24value = 0;
				var newbornsheep36value = 0;	var newbornsheep48value = 0;	var newbornsheep60value = 0;	var newbornaglessvalue = 0;
				//By Age count
				var newbornsheep1count = 0;		var newbornsheep2count = 0;		var newbornsheep3count = 0;		
				var newbornsheep4count = 0;		var newbornsheep5count = 0;		var newbornsheep12count = 0;	var newbornsheep24count = 0;
				var newbornsheep36count = 0;	var newbornsheep48count = 0;	var newbornsheep60count = 0;	var newbornaglesscount = 0;

				if ( response.newbornsheepnum > 0 ) {
					for (var i = 0; i < response[j].length; i++) {
						if ( response[j][i].age === '' || response[j][i].age === null ) {	
							newbornaglessvalue += Number(marketvalue[marketvaluemonth(response[j][i].age)]);
							newborntotalmarketvalue += Number(marketvalue[marketvaluemonth(response[j][i].age)]);
							newbornaglesscount += 1;
							newborntotalcount += 1;

						} else {
							var newbornagevalue = Number(response[j][i].age);
							newborntotalmarketvalue += Number(marketvalue[marketvaluemonth(newbornagevalue)]);
							newborntotalcount += 1;
							if (newbornagevalue == 1 ) { newbornsheep1count++; newbornsheep1value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  }
							if (newbornagevalue == 2 ) { newbornsheep2count++; newbornsheep2value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  }
							if (newbornagevalue == 3 ) { newbornsheep3count++; newbornsheep3value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  }
							if (newbornagevalue == 4 ) { newbornsheep4count++; newbornsheep4value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  }
							if (newbornagevalue == 5 ) { newbornsheep5count++; newbornsheep5value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  }
							if (newbornagevalue > 5  && newbornagevalue <= 12 && newbornagevalue !== null && newbornagevalue != 0) {	
								newbornsheep12count++;	newbornsheep12value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  
							}
							if (newbornagevalue > 12 && newbornagevalue <= 24 && newbornagevalue !== null && newbornagevalue != 0) {	
								newbornsheep24count++;	newbornsheep24value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  
							}
							if (newbornagevalue > 24 && newbornagevalue <= 36 && newbornagevalue !== null && newbornagevalue != 0) {	
								newbornsheep36count++;	newbornsheep36value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  
							}
							if (newbornagevalue > 36 && newbornagevalue <= 48 && newbornagevalue !== null && newbornagevalue != 0) {	
								newbornsheep48count++;	newbornsheep48value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  
							}
							if (newbornagevalue > 48 && newbornagevalue !== null && newbornagevalue != 0) {	
								newbornsheep60count++;	newbornsheep60value += Number(marketvalue[marketvaluemonth(newbornagevalue)])  
							}
						}
					}
					j++;
					
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-green text-center text-1 p-1">إنتاج الحلال</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';

					if ( newbornsheep1count != 0 || newbornsheep2count != 0 || newbornsheep3count != 0 || newbornsheep4count != 0 || newbornsheep5count || newbornsheep12count != 0 || newbornsheep24count != 0 || newbornsheep36count != 0 || newbornsheep48count != 0 || newbornsheep60count != 0 || newbornaglesscount != 0 ) {
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-muted text-center text-1 p-0 ma">العمر</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-center text-1 p-0 ma">العدد</span>';
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-muted text-center text-1 p-0 ma">القيمه السوقيه</span>';

						// Helper function to add one row
						function addSheepRow(newcard, label, count, value, marketIndex) {
							if (count <= 0) return newcard;
							const price = Number(marketvalue[marketvaluemonth(marketIndex)]);
							newcard += `
								<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-muted text-1 text-center mb-0 p-0" 
									  data-toggle="tooltip" data-placement="top" 
									  data-original-title="${price} ريال">${label}</span>
								<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-c-blue text-center text-1 p-0 ma">${count}</span>
								<span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 text-c-green text-center text-1 p-0 ma"></span>
								<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-c-green text-left text-1 p-0 ma">
									${value}<i class="text-muted" style="position: absolute; left: 11px; font-style: inherit;"> ريال</i>
								</span>`;
							return newcard;
						}
						// Usage — replace your long list of if-statements with this:
						newbornarray = [
							{ label: "شهر",			count: newbornsheep1count,  value: newbornsheep1value,  index: 1  },
							{ label: "شهرين",		count: newbornsheep2count,  value: newbornsheep2value,  index: 2  },
							{ label: "3 أشهر",		count: newbornsheep3count,  value: newbornsheep3value,  index: 3  },
							{ label: "4 أشهر",		count: newbornsheep4count,  value: newbornsheep4value,  index: 4  },
							{ label: "5 أشهر",		count: newbornsheep5count,  value: newbornsheep5value,  index: 5  },
							{ label: "6-12 شهر",		count: newbornsheep12count, value: newbornsheep12value, index: 6  },
							{ label: "1-2 عام",		count: newbornsheep24count, value: newbornsheep24value, index: 7  },
							{ label: "2-3 عام", 		count: newbornsheep36count, value: newbornsheep36value, index: 8  },
							{ label: "3-4 عام", 		count: newbornsheep48count, value: newbornsheep48value, index: 9  },
							{ label: "4 أعوام فأكثر",	count: newbornsheep60count,	value: newbornsheep60value, index: 10 },
							{ label: "غير محدد",      	count: newbornaglesscount,  value: newbornaglessvalue,  index: 12 }
						];

						// for Charting
						var newborncountarr = [];	newbornarray.forEach(cat => {    newborncountarr.push(cat.count);	});
						var newbornlabelarr = [];	newbornarray.forEach(cat => {    newbornlabelarr.push(cat.label);	});
						var newbornvaluearr = [];	newbornarray.forEach(cat => {    newbornvaluearr.push(cat.value);	});

						
						newbornarray.forEach(cat => {
							newcard = addSheepRow(newcard, cat.label, cat.count, cat.value, cat.index);
						});
								
						if ( newbornsheep1count != 0 || newbornsheep2count != 0 || newbornsheep3count != 0 || newbornsheep4count != 0 || newbornsheep5count || newbornsheep12count != 0 || newbornsheep24count != 0 || newbornsheep36count != 0 || newbornsheep48count != 0 || newbornsheep60count != 0 || newbornaglesscount != 0   ) {
							newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
							newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-muted text-center text-1 p-0 ma">الاجمالي</span>';
							newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-c-blue text-center text-1 p-0 ma">'+newborntotalcount+'</span>';
							newcard +=         '<span class="col-lg-1 col-md-1 col-sm-1 col-xs-1 text-c-green text-center text-1 p-0 ma"></span>';
							newcard +=         '<span class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-c-green text-left text-1 p-0 ma">'+newborntotalmarketvalue+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';

						}
					} else {
						newcard +=         '<span class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-muted text-1 text-center mb-0 p-0 ">لا يوجد إنتاج</span>';
					}
					
					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					newcard +=         '<div class="chart-container ma maxwidth" style="">';
					newcard +=          '<canvas id="newbornchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);
		// NewBorn Chart
					backgroundColor = ['#e74c3c','#2ecc71','#3498db','#f1c40f','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b'];

					dataCounts = [];			dataLabels = [];		dataValues = [];
					newbornarray.forEach((cat, idx) => {
						<!-- if (cat.count > 0) { -->
							dataCounts.push(cat.count);                // or cat.value if you want totals instead of counts
							dataLabels.push(cat.label);
							dataValues.push(cat.value);                // or cat.value if you want totals instead of counts
						<!-- } -->
					});

					barCount = newbornvaluearr.length; // ← number of visible bars
					calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					// Apply height to wrapper
					$('#newbornchart').parent().css('height', calculatedHeight + 'px');

					const newbornchart = document.getElementById('newbornchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(newbornchart, {
					  type: 'bar',
					  data: {
						labels: dataLabels,
						datasets: [{
						  label: 'العدد',
						  data: dataValues,
						  backgroundColor: backgroundColor,
						  borderColor: backgroundColor,
						  borderWidth: 1,
						  borderRadius: 6,
						  <!-- hoverBackgroundColor: '#ffffff33' -->
						}]
					  },
					  options: {
						indexAxis: 'y',                    // ← Makes it horizontal
						responsive: true,
						maintainAspectRatio: false,        // Allows full height usage
						layout: {
						  padding: { top: 0, bottom: 0, left: 0, right: 0 }  // More left space for long Arabic labels
						},
						plugins: {
						legend: {	display: false  },
						title: {
							display: true,
							text: 'المجموع '+newborntotalmarketvalue.toLocaleString('en-US')+' ريال ('+newborntotalcount+' رأس)',
							font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							color: '#064e3b', 
							padding: {  top: 5,	  bottom: 0	},
							align: 'center',
							position: 'bottom' // sets the position to the bottom
						},
						<!-- title: {	display: false	}, -->
						datalabels: {
							anchor: 'end',
							align: 'end',                  // Places labels to the right of bars
							<!-- color: '#333', -->
							color: (context) => {
								const value = context.dataset.data[context.dataIndex];
								const maxValue = Math.max(...context.dataset.data);
								
								if (maxValue === 0) return '#333';  // fallback
								
								const fiftyPercentOfMax = maxValue * 0.5;
								
								return value > fiftyPercentOfMax ? '#ffffff' : '#333333';
							},					
							font: { weight: 'bold', size: 16 },
							<!-- formatter: (value) => value, -->
							formatter: (value, newbornchart) => {
							  let sum = 0;
							  newbornchart.chart.data.datasets[0].data.forEach(d => sum += d);
							  const percentage = Math.round((value / sum) * 100);
							  let count = newborncountarr[newbornchart.dataIndex];
							  console.log('newbornchart.dataIndex',newbornchart.dataIndex);
							  console.log('count',count);
							  <!-- return value + '(' + percentage + '%)'; -->
							  if ( value > 0 ){
								  <!-- return '(' + percentage + '%) ' + value + '(' + count + ') ' ; -->
								  return '(' + count + ') ' + value;
							  } else {
								  return '';
							  }
							},
							<!-- offset: 30 -->
							// Dynamic horizontal offset based on bar length
							offset: (context) => {
							  const value = context.dataset.data[context.dataIndex];
							  const maxValue = Math.max(...context.dataset.data);
							  if (maxValue === 0) return 10;
							  const fiftyPercentOfMax = maxValue * 0.5;
							  if (value > fiftyPercentOfMax) {
								return -20;   // long bars (>50% of max) → pull label left/inside
							  } else if (value < fiftyPercentOfMax && value > maxValue*.05) {
								return 70;    // short or equal ≤50% → and > 10%
							  } else {
								return 55;    // short or equal ≤50% → push label far right
							  }
							},				
						},
						tooltip: {
							enabled: true,                    // keep it on (default anyway)
							displayColors: false,          // ← this removes the color boxes
							titleColor: '#e2e8f0',            // light title text
							align: 'center',
							cornerRadius: 8,                  // rounded corners
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							padding: 10,
							titleFont: { size: 20, weight: 'bold', family: 'Tajawal, sans-serif' },
							bodyFont: { size: 20, family: 'Tajawal, sans-serif' },
							// remove / change the little arrow/caret
							caretPadding: 10,
							caretSize: 6,
							callbacks: {
								label: (context) => {
								  let sum = context.dataset.data.reduce((a,b)=>a+b,0);
								  let perc = Math.round((context.raw / sum) * 100);
								  let count = newborncountarr[context.dataIndex];
								  return [
								  `${context.raw} ريال`,                          // Line 1: amount in ريال
									`العدد: ${count} رأس`,                     // Line 2: count + unit (with colon for readability)
									`النسبة: ${perc}%`,                     // Line 2: count + unit (with colon for readability)
								  ];
								}
							}

						  }	
						},
						scales: {
						  x: {
							display: false,
							beginAtZero: true,
						  },
						  y: {
							grid: {	  display: false  },
							ticks: {
							  font: {  size: 16,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							  autoSkip: false,
							  maxRotation: 0,
							  minRotation: 0
							},
							border: {
							  display: true  // Keeps the axis line
							}
						  }
						},
					  }
					});
				}		
		// Budget
				prenetbudget = capitallossarr['sold'] + previousprofit - totalspending;
				netbudget = prenetbudget + newborntotalmarketvalue;
				postbudget = netbudget - totalcapitalloss;

				if (totalspending > 0 || totalcapitalloss > 0 || newborntotalmarketvalue > 0 || (capitallossarr['sold'] + previousprofit) > 0) {
					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-emerald  text-center text-1 p-1">الموازنه الماليه</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 " >';
					newcard +=     '<div class="row stats" style="display:none;">';

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">اجمالي المصروفات</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+totalspending.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';


						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">مبيعات الحلال</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+(capitallossarr['sold']+previousprofit)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-dark  text-1 text-center  mb-0 p-0 ">الناتج (محقق)</span>';
						if ( prenetbudget >= 0 ) {
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+Math.abs(prenetbudget).toFixed(0)+'</span>';
						} else {
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+Math.abs(prenetbudget).toFixed(0)+'</span>';

						}
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">إنتاج الحلال</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+newborntotalmarketvalue.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-dark  text-1 text-center  mb-0 p-0 ">الناتج (غير محقق)</span>';
						if ( netbudget >= 0 ) {
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+Math.abs(netbudget).toFixed(0)+'</span>';
						} else {
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+Math.abs(netbudget).toFixed(0)+'</span>';

						}
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-muted text-1 text-center  mb-0 p-0 ">خسائر الحلال</span>';
						newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+totalcapitalloss.toFixed(0)+'</span>';
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';

						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7  text-dark  text-1 text-center  mb-0 p-0 ">الناتج (غير محقق)</span>';
						if ( postbudget >= 0 ) {
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-green text-left text-1 p-0 ma">'+Math.abs(postbudget).toFixed(0)+'</span>';
						} else {
							newcard +=         '<span class="col-lg-3 col-md-3 col-sm-3 col-xs-3  text-c-red text-left text-1 p-0 ma">'+Math.abs(postbudget).toFixed(0)+'</span>';

						}
						newcard +=         '<span class="col-lg-2 col-md-2 col-sm-2 col-xs-2 text-muted text-left text-1 p-0 ma"> ريال</span>';


					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					newcard +=         '<div class="chart-container ma maxwidth" style="">';
					newcard +=          '<canvas id="budgetchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					
					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);
		// Budget chart 
					backgroundColor = ['#e74c3c','#e74c3c','#2ecc71','#2ecc71','#9b59b6','#e67e22','#ff69b4','#1abc9c','#00bcd4','#cddc39','#3f51b5','#8d6e63','#e91e63','#009688','#673ab7','#ff9800','#607d8b','#f44336','#4caf50','#2196f3','#ffeb3b'];

					MIN_HEIGHT_PER_BAR = 75;
					barCount = 4; // number of bars
					EXTRA_SPACE = 160; // title + padding + margins estimate — adjust as needed
					calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					// Optional: set container height (good for vertical bars too if you want consistent look)
					$('#budgetchart').parent().css('height', calculatedHeight + 'px');

					const budgetchart = document.getElementById('budgetchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					new Chart(budgetchart, {
					  type: 'bar',
					  data: {
						labels: ['اجمالي المصروفات', 'خسائر الحلال', 'إنتاج الحلال', 'مبيعات الحلال'],
						datasets: [{
						  label: 'القيمة',
						  data: [	-totalspending, -totalcapitalloss, newborntotalmarketvalue, capitallossarr['sold'] + previousprofit ],
						  backgroundColor: backgroundColor.slice(0, 4),
						  borderColor: backgroundColor.slice(0, 4),
						  borderWidth: 1,
						  borderRadius: 6,
						}]
					  },
					  options: {
						responsive: true,
						maintainAspectRatio: false,
						layout: { 
							padding: { top: 20, bottom: 0, left: 0, right: 0 } // more right space for labels
						},
						plugins: {
						  legend: { display: false },
						  title: {
							display: false,
							<!-- text: [ -->
								  <!-- 'المجموع:', -->
								  <!-- '(محقق) ' + prenetbudget.toLocaleString('en-US') + ' ريال', -->
								  <!-- '(مع إنتاج الحلال) ' + netbudget.toLocaleString('en-US') + ' ريال', -->
								  <!-- '(مع خسائر الحلال) ' + postbudget.toLocaleString('en-US') + ' ريال' -->
							<!-- ], -->
							<!-- font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	}, -->
							<!-- color: function() { -->
							  <!-- return prenetbudget < 0 ? '#dc2626' : '#064e3b'; -->
							<!-- }, -->
							<!-- padding: { top: 30, bottom: 0 }, -->
							<!-- align: 'center', -->
							<!-- position: 'bottom'          // ← better at top for vertical bars (or keep 'bottom') -->
						  },
						  datalabels: {
							anchor: function(context) {			return context.dataset.data[context.dataIndex] >= 0 ? 'end' : 'start';		},
							align: function(context) {			return context.dataset.data[context.dataIndex] >= 0 ? 'top' : 'bottom';		},
							textAlign: 'center',       // ← force text centering (helps RTL a lot)
							color: '#555',
							font: { weight: 'bold', size: 16 },
							formatter: (value, ctx) => {
							  if ( value !== 0 ){	  return value;
							  } else {			  return '';  }
							},

						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', },
							bodyFont: { size: 20,  },
							callbacks: {
							  label: (context) => {
								const raw = context.raw;
								let sum = context.dataset.data.reduce((a, b) => a + b, 0);
								let perc = sum > 0 ? Math.round((raw / sum) * 100) : 0;
								let count = newborncountarr?.[context.dataIndex] ?? '—';
								return `${raw} ريال`
							  }
							}
						  }
						},
						scales: {
						  x: { display: false },  
						  y: {
							display: true,
							ticks: {
							  font: {	size: 12,	weight: '500', family: 'Tajawal, sans-serif' },
							  color: '#1f2937',
							  padding: 0,              // more space between label and bar
							  autoSkip: false,          // make sure all 4 labels show
							  maxRotation: 0,           // keep horizontal (good for short Arabic labels)
							  minRotation: 0
							}
						  }
						}	
					  }
					});
					
					var titlecode = '';
					<!-- titlecode += '<span class="maxwidth text-muted text-14 text-center  mb-0 p-0 ">المجموع</span>'; -->
					if ( prenetbudget > 0 ) {
						titlecode += '<span class="maxwidth text-green text-14 text-center  mb-0 p-0 ">ربح محقق '+prenetbudget.toLocaleString('en-US')+' ريال</span>';
					} else {
						titlecode += '<span class="maxwidth text-red text-14 text-center  mb-0 p-0 ">خسارة محققه '+prenetbudget.toLocaleString('en-US')+' ريال</span>';
					}
					if ( newborntotalmarketvalue != '0'	|| newborntotalmarketvalue != 0 ) {		
						if ( netbudget > 0 ) {
							titlecode += '<span class="maxwidth text-green text-14 text-center  mb-0 p-0 ">ربح غير محقق (مع إنتاج الحلال) '+netbudget.toLocaleString('en-US')+' ريال</span>';
						} else {
							titlecode += '<span class="maxwidth text-red text-14 text-center  mb-0 p-0 ">خسارة غير محققه  (مع إنتاج الحلال) '+netbudget.toLocaleString('en-US')+' ريال</span>';
						}
					}
					if ( totalcapitalloss != '0' || totalcapitalloss != 0 ) {	
						if ( postbudget > 0 ) {
							titlecode += '<span class="maxwidth text-green text-14 text-center  mb-0 p-0 ">ربح غير محقق (مع خسائر الحلال) '+postbudget.toLocaleString('en-US')+' ريال</span>';
						} else {
							titlecode += '<span class="maxwidth text-red text-14 text-center  mb-0 p-0 ">خسارة غير محققه  (مع خسائر الحلال) '+postbudget.toLocaleString('en-US')+' ريال</span>';
						}
					}
					$('#budgetchart').parent().after(titlecode);

				}

		// Bought Sheep and final budget
				var boughttotalmarketvalue = 0;
				var boughttotalcount = 0;
				var boughttotalcost = 0;

				if ( response.boughtsheepnum > 0 ) {
					for (var i = 0; i < response[j].length; i++) {
					
						if ( response[j][i].status === 'live' || response[j][i].status === 'sick' ) {	
							if ( response[j][i].age === '' || response[j][i].age === null ) {	
								boughttotalmarketvalue += Number(marketvalue[marketvaluemonth(response[j][i].age)]);
							} else {
								response[j][i].age = Number(response[j][i].age);
								boughttotalmarketvalue += Number(marketvalue[marketvaluemonth(response[j][i].age)]);
							}
						}
						
						boughttotalcount += 1;
						boughttotalcost += Number(response[j][i].cost);
						
					<!-- console.log('boughttotalmarketvalue',boughttotalmarketvalue); -->
					<!-- console.log('boughttotalcount',boughttotalcount); -->
					<!-- console.log('response[j][i].age',response[j][i].age); -->
					<!-- console.log('marketvaluemonth(response[j][i].age)',marketvaluemonth(response[j][i].age)); -->
					<!-- console.log('marketvaluemonth(response[j][i].age)',marketvaluemonth(1)); -->

					}
					j++;

					newcard = '';
					newcard += '<div class="col-lg-12 col-md-12 col-sm-12 mb-4">';
					newcard +=  '<div class="card card-icon-bg card-icon-bg-primary o-hidden mb-5" style="overflow: inherit;">';
					newcard +=   '<div class="card-header-emerald text-center text-1 p-1">الموازنه النهائيه</div>';
					newcard +=   '<div class="card-body text-center pt-4 pb-4">';
					newcard +=    '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 ">';
					newcard +=     '<div class="row stats" style="display:none;">';
					

						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7 text-muted text-center text-1 p-0 ma">ناتج الموازنه الماليه</span>';
						if ( postbudget > 0  ) {
							newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-c-green text-left text-1 p-0 ma">'+postbudget+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';
						} else {
							newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-c-red text-left text-1 p-0 ma">'+postbudget+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';
						}
						
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7 text-muted text-center text-1 p-0 ma">القيمه السوقيه للحلال</span>';
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-c-green text-left text-1 p-0 ma">'+boughttotalmarketvalue+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7 text-muted text-center text-1 p-0 ma">مشتريات الحلال</span>';
						newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-c-red text-left text-1 p-0 ma">'+boughttotalcost+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';
						
						finaltotal = postbudget + boughttotalmarketvalue - boughttotalcost;
						
						newcard += '<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 separator-breadcrumb border-top m-1"></div>';
						newcard +=         '<span class="col-lg-7 col-md-7 col-sm-7 col-xs-7 text-muted text-center text-1 p-0 ma">الناتح</span>';
						if ( finaltotal > 0 ) {
							newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-c-green text-left text-1 p-0 ma">'+finaltotal+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';
						} else {
							newcard +=         '<span class="col-lg-5 col-md-5 col-sm-5 col-xs-5 text-c-red text-left text-1 p-0 ma">'+finaltotal+'<i class="text-muted" style="position: absolute;left: 11px;font-style: inherit;"> ريال</i></span>';
						}
					
					newcard +=     '</div>';
					
					newcard +=        '<div class="row graphs" style="margin-right:-20px">';
					newcard +=         '<div class="chart-container ma maxwidth" style="">';
					newcard +=          '<canvas id="finalchart"></canvas>';
					newcard +=         '</div>';
					newcard +=     '</div>';

					newcard +=    '</div>';
					newcard +=   '</div>';
					newcard +=  '</div>';
					newcard += '</div>';
					$('.card-columns').append(newcard);
		// Bought Sheep and final budget Chart
					MIN_HEIGHT_PER_BAR = 75;
					barCount = 4; // number of bars
					EXTRA_SPACE = 160; // title + padding + margins estimate — adjust as needed
					calculatedHeight = (barCount * MIN_HEIGHT_PER_BAR) + EXTRA_SPACE;

					// Optional: set container height (good for vertical bars too if you want consistent look)
					$('#finalchart').parent().css('height', calculatedHeight + 'px');

					const finalchart = document.getElementById('finalchart').getContext('2d');
					Chart.defaults.font.family = 'Tajawal, sans-serif';
					Chart.register(ChartDataLabels);

					const values = [postbudget, boughttotalmarketvalue, -boughttotalcost];
					const backgroundColors = values.map(value => 	// red if negative else green
					  value >= 0 ? '#2ecc71' : '#e74c3c'
					);
					new Chart(finalchart, {
					  type: 'bar',
					  data: {
						labels: ['ناتج الموازنه الماليه', 'القيمه السوقيه للحلال', 'مشتريات الحلال'],
						datasets: [{
						  label: 'القيمة',
						  data: [	postbudget, boughttotalmarketvalue, -boughttotalcost ],
						  backgroundColor: backgroundColors,
						  borderColor: backgroundColors,
						  borderWidth: 1,
						  borderRadius: 6,
						}]
					  },
					  options: {
						responsive: true,
						maintainAspectRatio: false,
						layout: { 
							padding: { top: 20, bottom: 0, left: 0, right: 0 } // more right space for labels
						},
						plugins: {
						  legend: { display: false },
						  title: {
							display: true,
							text: [
								  'الناتج: ' + finaltotal + ' ريال',
							],
							font: {  size: 20,  weight: 'bold',	  family: 'Tajawal, sans-serif'	},
							color: function() {
							  return finaltotal < 0 ? '#dc2626' : '#064e3b';
							},
							padding: { top: 30, bottom: 0 },
							align: 'center',
							position: 'bottom'          // ← better at top for vertical bars (or keep 'bottom')
						  },
						  datalabels: {
							anchor: function(context) {			return context.dataset.data[context.dataIndex] >= 0 ? 'end' : 'start';		},
							align: function(context) {			return context.dataset.data[context.dataIndex] >= 0 ? 'top' : 'bottom';		},
							textAlign: 'center',       // ← force text centering (helps RTL a lot)
							color: '#555',
							font: { weight: 'bold', size: 16 },
							formatter: (value, ctx) => {
							  if ( value !== 0 ){	  return value;
							  } else {			  return '';  }
							},

						  },
						  tooltip: {
							displayColors: false,
							xAlign: 'center',
							yAlign: 'bottom',
							titleAlign: 'center',
							bodyAlign: 'center',
							cornerRadius: 8,
							padding: 10,
							titleFont: { size: 20, weight: 'bold', },
							bodyFont: { size: 20,  },
							callbacks: {
							  label: (context) => {
								const raw = context.raw;
								return `${raw} ريال`
							  }
							}
						  }
						},
						scales: {
						  x: { display: false },  
						  y: {
							display: true,
							ticks: {
							  font: {	size: 12,	weight: '500', family: 'Tajawal, sans-serif' },
							  color: '#1f2937',
							  padding: 0,              // more space between label and bar
							  autoSkip: false,          // make sure all 4 labels show
							  maxRotation: 0,           // keep horizontal (good for short Arabic labels)
							  minRotation: 0
							}
						  }
						}	
					  }
					});
				}
					
				$('.menu .item')
				  .tab()
				;

				let calculationsscript = document.createElement('script');
				calculationsscript.async = false;
				calculationsscript.defer = false;
				document.head.appendChild(calculationsscript);
				calculationsscript.onload = function(){
				}
				calculationsscript.src = 'js/scripts/tooltip.script.min.js';

			} else {
				showalert('danger','خطأ في جلب البيانات');
			}
		});	
// END OF Fetch Sheep Stats ////////////////////////////////////////////////////////////////////////////////
	} else {
		console.log("not sucess");
		window.location.replace("login.html");
	}
  });

// newborn gain				
	function marketvaluemonth(x) {
	  // Validate input
	  if (typeof x === 'number' ) {	
		  if ( x >= 0 && x < 6 ) {	return x;  }
		  if ( x >= 6 && x < 12 ) {	return 6;  }
		  if ( x >= 12 && x < 24 ) {	return 7;  }
		  if ( x >= 24 && x < 36 ) {	return 8;  }
		  if ( x >= 36 && x < 48 ) {	return 9;  }
		  if ( x >= 48 && x < 60 ) {	return 10;  }
		  if ( x >= 60 ) {	return 11;  }
	  } else if ( x === ' ' ||  x === '' ) {	
		return 12;  		
	  } 
	  <!-- else {		return console.log('marketvaluemonth is not number not empty not space');  		} -->
	}

	$(document).on("click", ".charttoggle", function(){
		<!-- console.log("fa-chart-pie"); -->
		$(this).find("svg").toggleClass('text-c-green');
		$('.row.graphs').fadeToggle();
		$('.row.stats').fadeToggle();
	});	

	
 	if (localStorage.getItem('status') !== null && localStorage.getItem('statusmessage') !== null) {		
		showalert(localStorage.getItem('status'),localStorage.getItem('statusmessage'));
		localStorage.removeItem('status');	localStorage.removeItem('statusmessage');	
	}
	
});

</script>

<ul class="nav nav-tabs fixed-bottom nav-justified" style="background: white;-top: 1px solid #6d6d71;border-radius: 5px;margin: 1px;border: 1px solid #6d6d71;padding-right: 0;">
   <li class="nav-item pt-2 " >
    <a class="nav-link p-0" aria-current="page" href="index.html">
	<i class="fa fa-home text-125"></i><br>الرئيسية</a>
  </li>
   <li class="nav-item active pt-2 " >
    <a class="nav-link p-0" aria-current="page" href="stats.html">
	<i class="fa fa-signal text-125"></i><br>بيانات</a>
  </li>
  <li class="nav-item pt-2 " >
    <a class="nav-link  p-0" aria-current="page" href="sheep.html">
	<i class="fa fa-tasks text-125"></i><br>إدارة</a>
  </li>
  <li class="nav-item pt-2 " >
    <a class="nav-link  p-0" aria-current="page" href="feed.html">
	<i class="fa fa-cubes text-125"></i><br>أعلاف</a>
  </li>
  <li class="nav-item pt-2 " >
    <a class="nav-link  p-0" aria-current="page" href="water.html">
	<i class="fa fa-tint text-125"></i><br>مياه</a>
  </li>
  <li class="nav-item pt-2 " >
    <a class="nav-link  p-0" aria-current="page" href="others.html">
	<i class="fa fa-syringe text-125"></i><br>اخرى</a>
  </li>
  <li class="nav-item pt-2 " >
    <a class="nav-link  p-0" aria-current="page" href="spending.html">
	<i class="fa fa-coins text-125"></i><br>مصاريف</a>
  </li>
</ul>

</body>

</html>